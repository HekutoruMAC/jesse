import{g as Q,P as J,M as X,r as d,i as k,j as Z,k as G,c as g,b as r,d as i,z as m,A as _,F as N,m as H,x as K,o as a,w as x,e as B,X as R,q as c,t as Y,C,Q as ee,Z as y}from"./BbUh6qYj.js";import{_ as te}from"./BnV_BqlS.js";import{_ as ne}from"./CRtivMH6.js";import{_ as oe}from"./D7y4u6st.js";import{_ as se}from"./CNIzb-jz.js";import{u as ae}from"./WI5VG1n5.js";const le={class:"container my-8 pb-24 flex flex-col min-h-screen"},ie={class:"pb-12 flex-grow"},re={class:"flex justify-between items-center mb-4"},ce={class:"flex gap-2"},ue={class:"flex flex-col lg:flex-row gap-4 items-center"},de={class:"flex flex-col sm:flex-row gap-2 sm:gap-0"},me={class:"flex-grow flex justify-center"},pe={class:"flex items-center gap-2 justify-end"},ve=Q({__name:"index",setup(ge){ae({title:"Import Candles - Jesse"});const o=J(),S=X(),h=d([]),u=d(""),f=d([]),V=k(()=>S.backtestingExchangeNames),E=k(()=>o.forms.some(e=>!e.executing)),M=k(()=>o.forms.some(e=>e.executing)),b=d(new Set),v=d(new Set);function I(){const e=o.forms[o.forms.length-1];o.forms.push({id:C.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}function T(e){const t=o.forms.indexOf(e);o.forms.splice(t+1,0,{id:C.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}})}async function j(e){b.value.add(e.id),e.executing&&await w(e.id);const t=o.forms.indexOf(e);o.forms.length>1&&o.forms.splice(t,1),b.value.delete(e.id)}async function U(e){const t=await S.getExchangeSupportedSymbols(e.exchange);f.value=t,t.includes(e.symbol)||(e.symbol=t[0]),z(u.value)}function z(e){if(e.length==0||!f.value.length){h.value=[];return}const t=[];for(const s of f.value){if(t.length>50)break;s.toLowerCase().startsWith(e.toLowerCase())&&t.push(s)}h.value=t}Z(()=>u.value,e=>{z(e)});function F(e){const t=o.forms.find(s=>s.id===e);t&&q(t)&&o.start(e)}function q(e){return e.exchange?e.symbol?e.symbol.includes("-")?e.start_date?!0:(y("error","Start date parameter cannot be empty"),!1):(y("error",'Symbol parameter must contain "-" character!'),!1):(y("error","Symbol parameter cannot be empty"),!1):(y("error","Exchange parameter cannot be empty"),!1)}G(()=>{o.forms[0].exchange||(o.forms[0].exchange=V.value[0]),setTimeout(()=>{U(o.forms[0])},100)});async function w(e){v.value.add(e),await o.cancel(e),v.value.delete(e)}async function P(){const e=o.forms.filter(t=>!t.executing);await Promise.all(e.map(t=>F(t.id)))}async function D(){const e=o.forms.filter(t=>t.executing||t.waiting);await Promise.all(e.map(t=>w(t.id)))}return(e,t)=>{const s=K,$=te,L=R,O=ne,A=ee,p=oe,W=se;return a(),g("div",le,[r("div",ie,[r("div",re,[i(s,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-plus",size:"lg",variant:"solid",label:"Add",onClick:I}),r("div",ce,[_(o).forms.length>1?(a(),g(N,{key:0},[i(s,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-arrow-down-tray",size:"lg",variant:"outline",label:"Import All",disabled:!E.value,onClick:P},null,8,["disabled"]),i(s,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-x-mark",variant:"outline",size:"lg",color:"rose",label:"Cancel All",disabled:!M.value,onClick:D},null,8,["disabled"])],64)):m("",!0),i(s,{class:"shadow-sm px-4 py-1.5",icon:"i-heroicons-wrench",size:"lg",variant:"outline",color:"gray",label:"Manage",to:"/candles/manage"})])]),(a(!0),g(N,null,H(_(o).forms,n=>(a(),g("div",{key:n.id,class:"mt-4 border rounded-lg p-4 bg-white dark:border-gray-900 dark:bg-gray-800"},[r("div",ue,[r("div",de,[i($,{modelValue:n.exchange,"onUpdate:modelValue":l=>n.exchange=l,class:"w-full sm:w-48",ui:{base:"sm:rounded-r-none",input:"rounded-lg sm:rounded-r-none sm:rounded-l-lg"},searchable:"",size:"lg",options:V.value,placeholder:"Select exchange...",onChange:()=>U(n)},null,8,["modelValue","onUpdate:modelValue","options","onChange"]),i($,{modelValue:n.symbol,"onUpdate:modelValue":l=>n.symbol=l,query:u.value,"onUpdate:query":t[0]||(t[0]=l=>u.value=l),"clear-search-on-close":"",class:"w-full sm:w-64",ui:{base:"sm:rounded-none",input:"rounded-lg sm:rounded-none"},searchable:"",size:"lg",options:h.value,placeholder:"Select symbol...",onChange:t[1]||(t[1]=l=>u.value="")},{empty:x(()=>t[2]||(t[2]=[B("Start typing...")])),_:2},1032,["modelValue","onUpdate:modelValue","query","options"]),i(L,{modelValue:n.start_date,"onUpdate:modelValue":l=>n.start_date=l,type:"date",size:"lg",class:"w-full sm:w-48",ui:{base:"sm:rounded-l-none",input:"rounded-lg sm:rounded-l-none sm:rounded-r-lg"}},null,8,["modelValue","onUpdate:modelValue"])]),r("div",me,[n.executing?(a(),c(O,{key:0,color:"blue",variant:"subtle"},{default:x(()=>[B(Y(_(C).remainingTimeText(n.progressbar.estimated_remaining_seconds)),1)]),_:2},1024)):m("",!0)]),r("div",pe,[n.executing?(a(),c(s,{key:1,size:"sm",variant:"soft",color:"rose",label:"Cancel",icon:"i-heroicons-x-mark",loading:v.value.has(n.id),onClick:l=>w(n.id)},null,8,["loading","onClick"])):(a(),c(s,{key:0,size:"sm",variant:"soft",label:"Import",color:"primary",icon:"i-heroicons-arrow-down-tray",onClick:l=>F(n.id)},null,8,["onClick"])),i(A,{text:"Duplicate"},{default:x(()=>[i(s,{size:"sm",variant:"link",color:"gray",icon:"i-heroicons-document-duplicate",onClick:l=>T(n)},null,8,["onClick"])]),_:2},1024),_(o).forms.length>1?(a(),c(A,{key:2,text:"Delete"},{default:x(()=>[i(s,{size:"sm",variant:"link",color:"rose",icon:"i-heroicons-trash",loading:b.value.has(n.id),onClick:l=>j(n)},null,8,["loading","onClick"])]),_:2},1024)):m("",!0)])]),r("div",null,[n.alert.type==="info"?(a(),c(p,{key:0,class:"mt-4",color:"gray",variant:"soft",icon:"i-heroicons-information-circle",title:n.alert.message},null,8,["title"])):m("",!0),n.waiting?(a(),c(p,{key:1,class:"mt-4",color:"yellow",variant:"soft",icon:"i-heroicons-clock",title:`Queued: Waiting for the current '${n.exchange}' import to finish...`},null,8,["title"])):n.executing?(a(),c(W,{key:2,value:n.progressbar.current,indicator:"",class:"w-full mt-4"},null,8,["value"])):n.exception.error?(a(),c(p,{key:3,class:"mt-4",color:"red",variant:"soft",icon:"i-heroicons-exclamation-triangle",title:n.exception.error},null,8,["title"])):n.alert.type==="success"?(a(),c(p,{key:4,class:"mt-4",color:"green",variant:"soft",icon:"i-heroicons-check-circle",title:n.alert.message},null,8,["title"])):m("",!0)])]))),128)),t[3]||(t[3]=r("div",{class:"h-24 md:h-32"},null,-1))])])}}});export{ve as default};
