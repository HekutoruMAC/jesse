import{_ as He}from"./DK_Z5CEB.js";import{_ as Ye}from"./DFlKk7v0.js";import{g as Z,r as T,h as E,i as G,n as Je,j as Qe,c as m,o as r,k as U,l as h,d as a,m as q,b as s,t as C,F as H,p as me,q as ge,s as Ue,v as Ce,x as Oe,y as Ge,z as $e,w as R,A as Ze,B as je,C as Me,D as l,E as J,G as ie,H as Le,I as Xe,J as Pe,K as fe,e as ke,L as xe,M as Be,N as Q,O as we,P as Ke,Q as Ne,R as et,S as tt,T as st,U as ot,V as lt,W as de,X as rt,Y as at,Z as nt,$ as it,a0 as oe,a1 as dt,a2 as ut,a3 as ct,a4 as ft}from"./DKy04F99.js";import{T as _e,r as mt,_ as vt,a as pt,b as gt,c as yt,d as bt}from"./CVOeGlPI.js";import{_ as ht}from"./DwSXSOPC.js";import{_ as wt}from"./WagonbJr.js";import{s as Re,l as kt,d as xt}from"./lA_J2Fq2.js";import{_ as _t}from"./DV68kx52.js";import{s as pe,l as Ee,d as ze,_ as Ct,u as $t}from"./BgjeN5gZ.js";import{u as Vt}from"./BWJqst_Z.js";import"./jlhGtBiN.js";const Tt={class:"w-full h-full flex flex-col"},St={key:0,class:"flex justify-center items-center py-8"},jt={class:"w-full relative"},Lt={key:0,class:"whitespace-pre-line select-text text-base dark:text-gray-300 w-full mb-1"},Rt={key:3,class:"mt-4 flex justify-center"},ue=1e3,Et=Z({__name:"Logs",props:{logs:{},sections:{},totalLogs:{}},setup(M){const d=M,p=T(""),c=T(!1),n=T(!1),i=T([]),f=T(null),t=T(1),u=T(!1),b=T(ue),x=E(()=>u.value?i.value:i.value.slice(0,b.value));G(()=>d.logs,async k=>{k&&(c.value=!0,await Je(),setTimeout(()=>{i.value=k.slice(0,ue),t.value=1,u.value=k.length<=ue,c.value=!1},0),setTimeout(()=>{p.value=d.logs.join(`
`)},0))},{immediate:!0}),G(t,()=>{b.value=t.value*ue});function g(k){const j=k.target;j.scrollHeight-j.scrollTop<=j.clientHeight+50&&w()}async function w(){n.value||u.value||(n.value=!0,setTimeout(()=>{const k=t.value*ue,j=(t.value+1)*ue;if(k<d.logs.length){const P=d.logs.slice(k,j);i.value=[...i.value,...P],t.value++,u.value=j>=d.logs.length}else u.value=!0;n.value=!1},0))}return(k,j)=>{const P=Qe("ULoading"),B=Ye,Y=ge;return r(),m("div",Tt,[c.value?(r(),m("div",St,[a(P,{size:"lg"})])):i.value.length?(r(),m("div",{key:2,ref_key:"logContainer",ref:f,class:q([u.value?"h-[calc(100vh-120px)]":"h-[calc(100vh-180px)]","w-full overflow-y-scroll rounded border dark:border-gray-600 bg-gray-50 dark:bg-gray-700 px-4 sm:px-6 py-2"]),onScroll:g},[s("div",jt,[u.value?(r(),m("pre",Lt,"          "+C(p.value)+`
        `,1)):(r(!0),m(H,{key:1},me(x.value,(D,A)=>(r(),m("pre",{key:0+A,class:"whitespace-pre-line select-text text-base dark:text-gray-300 w-full mb-1"},C(D),1))),128))])],34)):(r(),U(B,{key:1})),i.value.length&&!u.value?(r(),m("div",Rt,[a(Y,{loading:n.value,class:"w-full flex justify-center",label:`(loaded ${i.value.length} / ${d.logs.length}) Load All Logs`,onClick:j[0]||(j[0]=D=>u.value=!0)},null,8,["loading","label"])])):h("",!0)])}}}),zt={class:"mt-2"},Ut={class:"ml-2"},Ot=Z({__name:"EquityCurve",props:{data:{}},setup(M){const d=Ue(),p=E(()=>d.value),c=T();let n=null,i=[];const f=M;G(f.data,x=>{}),G(p,x=>{b(x)}),Ce(async()=>{await t()});async function t(){Re.width=c.value.clientWidth,n=_e(c.value,Re);for(const x of f.data){const g=n.addLineSeries({lineWidth:2});g.setData(x.data),i.push(g)}n.timeScale().fitContent(),b(p.value)}Oe(()=>{u()});function u(){n!==null&&(n.remove(),n=null),i&&(i=[])}function b(x){n===null||i===null||n.applyOptions(x==="light"?kt.chart:xt.chart)}return(x,g)=>(r(),m(H,null,[s("div",{ref_key:"chartContainer",ref:c,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),s("div",zt,[(r(!0),m(H,null,me(x.data,w=>(r(),m("span",{key:w.name,class:"text-xs mr-2 rounded bg-white dark:bg-gray-700 p-1"},[s("span",{class:"inline-block",style:Ge({backgroundColor:w.color,width:"25px",height:"10px"})},null,4),s("span",Ut,C(w.name),1)]))),128))])],64))}}),Mt={class:"flex items-center justify-between"},Pt=Z({__name:"FullscreenModal",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(M){const d=$e(M,"modelValue");return(p,c)=>{const n=ge,i=Ze,f=Me;return r(),U(f,{modelValue:d.value,"onUpdate:modelValue":c[1]||(c[1]=t=>d.value=t),fullscreen:""},{default:R(()=>[a(i,{ui:{base:"h-full flex flex-col",rounded:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",body:{base:"grow"}}},{header:R(()=>[s("div",Mt,[s("div",null,[je(p.$slots,"title")]),a(n,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:c[0]||(c[0]=t=>d.value=!1)})])]),default:R(()=>[je(p.$slots,"default")]),_:3})]),_:3},8,["modelValue"])}}}),Bt={class:"w-16 overflow-hidden"},Nt={class:"w-8 overflow-hidden"},It={key:0,class:"w-full transition-all overflow-hidden duration-300 bg-gray-50 dark:bg-gray-800"},Dt=["onClick"],At={class:"w-16 overflow-hidden text-center"},Ft={class:"w-12 overflow-hidden text-center"},Wt={class:"w-8 overflow-hidden text-center"},qt={class:"p-4"},Ht={class:"mt-4"},Yt={class:"w-full text-sm"},Jt={class:"w-full"},Qt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Gt={class:"w-full flex justify-between py-2 px-4"},Zt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Xt={class:"w-full flex justify-between py-2 px-4"},Kt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},es={class:"w-full flex justify-between py-2 px-4"},ts={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},ss={class:"w-full flex justify-between py-2 px-4"},os={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},ls={class:"w-full"},rs={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},as={class:"w-full flex justify-between py-2 px-4"},ns={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},is={key:0,class:"w-full flex justify-between py-2 px-4"},ds={key:1,class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},us={key:2,class:"w-full flex justify-between py-2 px-4"},cs={class:"flex justify-end mt-4"},fs=Z({__name:"ChartOrders",props:{trade:{}},emits:["zoom","hoverbg"],setup(M,{emit:d}){const p=d,c=T(null),n=T(!1),i=T(!1);return(f,t)=>{const u=Xe,b=ge,x=Me;return r(),m(H,null,[a(b,{variant:"ghost",color:"gray",class:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 text-xs border-b border-gray-100 dark:border-gray-800 rounded-none p-2",onClick:t[1]||(t[1]=g=>i.value=!l(i)),onMouseover:t[2]||(t[2]=g=>p("hoverbg",f.trade.orders[0].id))},{default:R(()=>[s("div",{class:q(["w-2 transition-all duration-300",[l(i)?"rotate-90":"rotate-0"]])},t[5]||(t[5]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})],-1)]),2),s("div",Bt,C(l(J).roundPrice(f.trade.entry_price)),1),t[6]||(t[6]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:q(["w-16 overflow-hidden",f.trade.type.toLowerCase()==="long"?"text-green-500":"text-red-500"])},C(l(ie).round(f.trade.qty,2)),3),t[7]||(t[7]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:q([[f.trade.PNL_percentage>0?"text-green-500":"text-red-500"],"w-16 overflow-hidden text-xs"])},C(l(ie).round(f.trade.PNL_percentage,2))+"% ",3),t[8]||(t[8]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Nt,[a(b,{color:"gray",size:"xs",onClick:t[0]||(t[0]=Le(g=>p("zoom",f.trade.orders[0].id),["stop"]))},{default:R(()=>[a(u,{name:"i-heroicons-arrow-right"})]),_:1})])]),_:1}),l(i)?(r(),m("div",It,[t[13]||(t[13]=Pe('<div class="flex justify-between items-center border-b-2 border-gray-200 dark:border-gray-700 px-1 py-2 text-xs"><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PRICE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-12 overflow-hidden italic font-bold uppercase text-center">TYPE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">SIDE</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(r(!0),m(H,null,me(f.trade.orders,(g,w)=>(r(),m("div",{key:w,class:"w-full flex justify-between items-center hover:bg-gray-200 dark:hover:bg-gray-900 text-xs py-2 border-b border-gray-200 cursor-pointer dark:border-gray-700 px-1",onClick:k=>{c.value=g,n.value=!0}},[s("div",At,C(l(J).roundPrice(g.price)),1),t[9]||(t[9]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:q(["w-10 overflow-hidden text-center",g.side==="buy"?"text-green-500":"text-red-500"])},C(l(ie).round(g.qty,2)),3),t[10]||(t[10]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Ft,C(g.type),1),t[11]||(t[11]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:q([[g.side==="buy"?"text-green-500":"text-red-500"],"w-10 overflow-hidden text-center"])},C(g.side.toUpperCase()),3),t[12]||(t[12]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Wt,[a(b,{color:"gray",size:"xs",onClick:Le(k=>p("zoom",g.id),["stop"])},{default:R(()=>[a(u,{name:"i-heroicons-arrow-right"})]),_:2},1032,["onClick"])])],8,Dt))),128))])):h("",!0),a(x,{modelValue:l(n),"onUpdate:modelValue":t[4]||(t[4]=g=>fe(n)?n.value=g:null)},{default:R(()=>{var g,w,k,j,P,B,Y,D,A,X,le;return[s("div",qt,[s("div",Ht,[s("div",Yt,[t[29]||(t[29]=s("h2",{class:"text-lg mb-2 font-bold italic dark:text-white text-center"}," Trade ",-1)),s("div",Jt,[s("div",Qt,[t[14]||(t[14]=s("div",{class:"font-bold"},"Entry Price",-1)),s("div",null,C(l(J).roundPrice(f.trade.entry_price)),1)]),s("div",Gt,[t[15]||(t[15]=s("div",{class:"font-bold"},"Exit Price",-1)),s("div",null,C(l(J).roundPrice(f.trade.exit_price)),1)]),s("div",Zt,[t[16]||(t[16]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,C(f.trade.qty),1)]),s("div",Xt,[t[17]||(t[17]=s("div",{class:"font-bold"},"Size",-1)),s("div",null,C(l(J).roundPrice(f.trade.size)),1)]),s("div",Kt,[t[18]||(t[18]=s("div",{class:"font-bold"},"PNL",-1)),s("div",{class:q([f.trade.PNL>0?"text-green-500":"text-red-500"])},C(l(ie).round(f.trade.PNL,2))+" ("+C(l(ie).round(f.trade.PNL_percentage,2))+"%) ",3)]),s("div",es,[t[19]||(t[19]=s("div",{class:"font-bold"},"Fee",-1)),s("div",null,C(l(ie).round(f.trade.fee,2)),1)]),s("div",ts,[t[20]||(t[20]=s("div",{class:"font-bold"},"Holding Period",-1)),s("div",null,C(l(J).secondsToHumanReadable(f.trade.holding_period)),1)]),s("div",ss,[t[21]||(t[21]=s("div",{class:"font-bold"},"Opened At",-1)),s("div",null,C(new Date(f.trade.opened_at).toLocaleString()),1)]),s("div",os,[t[22]||(t[22]=s("div",{class:"font-bold"},"Closed At",-1)),s("div",null,C(new Date(f.trade.closed_at).toLocaleString()),1)])]),t[30]||(t[30]=s("h2",{class:"text-lg font-bold italic dark:text-white mt-6 mb-2 text-center"}," Order ",-1)),s("div",ls,[s("div",rs,[t[23]||(t[23]=s("div",{class:"font-bold"},"Side",-1)),s("div",{class:q([((g=l(c))==null?void 0:g.side)==="buy"?"text-green-500":"text-red-500"])},C((k=(w=l(c))==null?void 0:w.side)==null?void 0:k.toUpperCase()),3)]),s("div",as,[t[24]||(t[24]=s("div",{class:"font-bold"},"Type",-1)),s("div",null,C((j=l(c))==null?void 0:j.type),1)]),s("div",ns,[t[25]||(t[25]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,C((P=l(c))==null?void 0:P.qty),1)]),(B=l(c))!=null&&B.created_at?(r(),m("div",is,[t[26]||(t[26]=s("div",{class:"font-bold"},"Created At",-1)),s("div",null,C(new Date((Y=l(c))==null?void 0:Y.created_at).toLocaleString()),1)])):h("",!0),(D=l(c))!=null&&D.executed_at?(r(),m("div",ds,[t[27]||(t[27]=s("div",{class:"font-bold"},"Executed At",-1)),s("div",null,C(new Date((A=l(c))==null?void 0:A.executed_at).toLocaleString()),1)])):h("",!0),(X=l(c))!=null&&X.canceled_at?(r(),m("div",us,[t[28]||(t[28]=s("div",{class:"font-bold"},"Canceled At",-1)),s("div",null,C(new Date((le=l(c))==null?void 0:le.canceled_at).toLocaleString()),1)])):h("",!0)])]),s("div",cs,[a(b,{color:"gray",block:"",onClick:t[3]||(t[3]=ve=>n.value=!1)},{default:R(()=>t[31]||(t[31]=[ke(" Close ")])),_:1})])])])]}),_:1},8,["modelValue"])],64)}}}),ms={class:"w-0 sidebar whitespace-nowrap relative transition-all duration-300"},vs={key:1,class:"h-full flex justify-center items-center text-xs text-gray-500"},ps=Z({__name:"ChartSidebar",props:xe({items:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:xe(["zoom","hoverbg"],["update:modelValue"]),setup(M,{emit:d}){const p=$e(M,"modelValue"),c=d;return(n,i)=>{const f=fs;return r(),m("div",ms,[s("div",{class:q([p.value?"w-96 p-2":"w-0 p-0","absolute h-full overflow-y-auto border-r-2 dark:border-gray-800 transition-all duration-300 z-0"])},[n.items.length>0?(r(),m(H,{key:0},[i[2]||(i[2]=Pe('<div class="flex justify-between items-center border-b-2 p-2 text-xs dark:border-gray-800"><div class="w-2"></div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">ENTRY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PNL</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(r(!0),m(H,null,me(n.items,(t,u)=>(r(),m("div",{key:u,class:"w-full"},[a(f,{trade:t,onZoom:i[0]||(i[0]=b=>c("zoom",b)),onHoverbg:i[1]||(i[1]=b=>c("hoverbg",b))},null,8,["trade"])]))),128))],64)):(r(),m("div",vs," No trades were executed "))],2)])}}}),gs={class:"w-full h-full flex justify-between border-2 border-gray-200 dark:border-gray-800 rounded-lg"},ys={class:"w-full flex flex-col h-full border dark:border-gray-800"},bs={key:0},hs=Z({__name:"BacktestCandlesChart",props:xe({form:{},results:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(M){const d=Ue(),p=T(2),c=$e(M,"modelValue"),n=M,i=T(),f=T([]);let t=null,u=null;const b=[],x=[],g=E(()=>Be().params.id),w=E(()=>Q.extraChartLines[g.value].find(y=>y.symbol===n.results.selectedRoute.symbol)),k=E(()=>d.value),j=E(()=>ye());G(k,y=>{X(y)}),G(()=>n.results.selectedRoute.symbol,()=>{A(),setTimeout(async()=>{await P()},100)}),Ce(async()=>{setTimeout(async()=>{await P()},200)}),G(c,()=>{setTimeout(()=>{B()},300)});async function P(){var re,ae,ne,I;pe.width=i.value.clientWidth,pe.height=i.value.clientHeight-Object.keys(w.value.charts).length*150,t=_e(i.value,pe),t.applyOptions({rightPriceScale:{borderColor:k.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${n.results.selectedRoute.symbol} • ${n.results.selectedRoute.timeframe}`}}),u=t.addCandlestickSeries();const y=Q.candles[g.value].find(V=>V.symbol===n.results.selectedRoute.symbol).candles;u.setData(y),u.setMarkers(Q.orders[g.value].find(V=>V.symbol===n.results.selectedRoute.symbol).orders);const _=String(y[0].open).indexOf("."),$=_===-1?0:String(y[y.length-1].open).length-_-1;p.value!==$&&(p.value=$,(p.value<0||p.value>100)&&(p.value=0),u.applyOptions({priceFormat:{type:"price",precision:p.value,minMove:Math.pow(10,-p.value).toFixed(p.value)}}));const L=(ae=(re=Q.lines[g.value])==null?void 0:re.find(V=>V.symbol===n.results.selectedRoute.symbol))==null?void 0:ae.lines;if(L)for(const V of Object.keys(L)){const z=L[V];t.addLineSeries({lineWidth:1,title:V}).setData(z.data)}const O=(I=(ne=Q.horizontalLines[g.value])==null?void 0:ne.find(V=>V.symbol===n.results.selectedRoute.symbol))==null?void 0:I.lines;if(O)for(const V of Object.keys(O)){const e=O[V];u.createPriceLine(e)}t.timeScale().fitContent();const N=new Set;Object.keys(w.value.charts).forEach((V,z)=>{const e={...pe};e.width=f.value[z].clientWidth,e.height=150;const o=_e(f.value[z],e);b.push(o),Object.keys(w.value.charts[V]).forEach(F=>{var ee,S;const W=o.addLineSeries({lineWidth:1,title:F}),K=(S=(ee=Q.horizontalExtraLines[g.value])==null?void 0:ee.find(ce=>ce.symbol===n.results.selectedRoute.symbol))==null?void 0:S.lines[V];if(K&&!N.has(V)){for(const ce of Object.keys(K)){const te=K[ce];W.createPriceLine(te)}N.add(V)}W.setData(w.value.charts[V][F].data),x.push(W)}),o.applyOptions({rightPriceScale:{borderColor:k.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:V}}),o.timeScale().subscribeVisibleLogicalRangeChange(F=>{t.timeScale().setVisibleLogicalRange(F)}),z!==Object.keys(w.value.charts).length-1&&o.timeScale().applyOptions({visible:!1})}),t.subscribeCrosshairMove(V=>{const z=Y(u,V);Object.keys(w.value.charts).forEach((e,o)=>{D(b[o],x[o],z)})}),Object.keys(w.value.charts).forEach((V,z)=>{b[z].subscribeCrosshairMove(e=>{const o=Y(x[z],e);D(t,u,o),b.forEach((F,W)=>{W!==z&&D(F,x[W],o)})})}),t.timeScale().subscribeVisibleLogicalRangeChange(V=>{b.forEach(z=>{z.timeScale().setVisibleLogicalRange(V)})}),X(k.value),b.length>0&&t.timeScale().applyOptions({visible:!1})}function B(){var y;t!==null&&(t.applyOptions({width:(y=i.value)==null?void 0:y.clientWidth}),b.forEach(_=>{var $;_.applyOptions({width:($=i.value)==null?void 0:$.clientWidth})}))}Oe(()=>{A()});function Y(y,_){return _.time&&_.seriesData.get(y)||null}function D(y,_,$){if($){y.setCrosshairPosition($.value,$.time,_);return}y.clearCrosshairPosition()}function A(){t!==null&&(t.remove(),t=null),u!==null&&(u=null),b.length>0&&(b.forEach(y=>{y.remove()}),b.length=0),x.length>0&&(x.length=0)}function X(y){t!==null&&(t.applyOptions(y==="light"?Ee.chart:ze.chart),b.forEach(_=>{_.applyOptions(y==="light"?Ee.chart:ze.chart)}))}function le(y){const _=Q.orders[g.value].find(L=>L.symbol===n.results.selectedRoute.symbol).orders,$=_.find(L=>L.order_id===y);if($&&t){const L=(typeof $.time=="number",$.time),O=t.timeScale(),N=_[1].time-_[0].time,re=L-N*5,ae=L+N*5,ne=$.color;u==null||u.setMarkers(_.map(I=>I.order_id===y?{...I,color:"#FFA500"}:I)),O.setVisibleRange({from:re,to:ae}),setTimeout(()=>{u==null||u.setMarkers(_.map(I=>I.order_id===y?{...I,color:ne}:I))},2e3)}}function ve(y){const _=Q.orders[g.value].find(L=>L.symbol===n.results.selectedRoute.symbol).orders,$=_.find(L=>L.order_id===y);if($&&t){const L=$.color;u==null||u.setMarkers(_.map(O=>O.order_id===y?{...O,color:"#FFA500"}:O)),setTimeout(()=>{u==null||u.setMarkers(_.map(O=>O.order_id===y?{...O,color:L}:O))},2e3)}}function ye(){return n.results.trades.filter(y=>y.symbol===n.results.selectedRoute.symbol)}return(y,_)=>(r(),m("div",gs,[a(ps,{modelValue:c.value,"onUpdate:modelValue":_[0]||(_[0]=$=>c.value=$),items:l(j),onHoverbg:_[1]||(_[1]=$=>ve($)),onZoom:_[2]||(_[2]=$=>le($))},null,8,["modelValue","items"]),s("div",{class:q([[c.value?"w-[calc(100%-384px)]":"w-full"],"h-full transition-all duration-300"])},[s("div",ys,[s("div",{ref_key:"chartContainer",ref:i,class:"rounded overflow-hidden flex-grow"},null,512),l(w)&&Object.keys(l(w).charts).length?(r(),m("div",bs,[(r(!0),m(H,null,me(Object.keys(l(w).charts),$=>(r(),m("div",{key:$,ref_for:!0,ref_key:"extraChartsRef",ref:f,class:"relative border-t-[1.5px] dark:border-gray-800"}))),128))])):h("",!0)])],2)]))}}),ws={key:0,class:"flex flex-col items-center justify-center select-none mt-[10%]"},ks=["textContent"],xs={class:"mt-8"},_s={class:"mt-8 flex flex-col gap-4"},Cs={key:0,class:"mt-4"},$s={key:1,class:"mx-auto container mt-8"},Vs={key:0},Ts={class:"mb-4 mt-4"},Ss={class:"flex items-center select-none flex-1 my-4"},js={class:"grid grid-cols-1 gap-6 mt-8"},Ls={key:1,class:"w-full mx-auto"},Rs={key:4,class:"text-yellow-500 border-yellow-400 bg-yellow-50 dark:bg-gray-700 dark:text-yellow-400 mt-16 text-center text-2xl rounded border-2 border-dashed dark:border-gray-800 py-16 select-none"},Es={class:"flex justify-start"},zs={key:0},Us={key:0},Os=["href"],Ms=["href"],Ps=["href"],Bs={key:5,class:"my-4"},Ns={key:1},Is=Z({__name:"BacktestTab",props:{form:{},results:{}},setup(M){const d=M,p=T(!1),c=T(!0),n=T(!1),i=T([]),f=T([]),t=T(!1),u=T(!1),b=we().authToken,x=T(Ke().public.apiBaseUrl),g=T(!1),w=E(()=>Be().params.id),k=Ne(),j=we(),P=et(),B=T([]),Y=E(()=>j.jesseSupportedTimeframes.map(e=>({label:e,value:e}))),D=E(()=>d.form.routes.map(e=>({label:`${e.strategy} • ${e.symbol}`,value:e})));d.results.selectedRoute=d.form.routes[0],Ce(async()=>{setTimeout(async()=>{await j.initiate(),!d.form.exchange&&j.backtestingExchangeNames.length&&(d.form.exchange=j.backtestingExchangeNames[0]),(!d.results.showResults&&d.form.exchange||!B.value.length)&&await A()},50)});async function A(){if(d.form.exchange)try{B.value=await j.getExchangeSupportedSymbols(d.form.exchange);for(let e=0;e<d.form.routes.length;e++)B.value.includes(d.form.routes[e].symbol)||(d.form.routes[e].symbol=B.value[0]);if(d.form.data_routes.length>0)for(let e=0;e<d.form.data_routes.length;e++)B.value.includes(d.form.data_routes[e].symbol)||(d.form.data_routes[e].symbol=B.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}G(()=>d.form.exchange,async(e,o)=>{e!==o&&await A()});const{cancel:X,newBacktest:le,retry:ve}=k;function ye(e){if(f.value.length){for(let o=0;o<f.value.length;o++)oe("error",f.value[o]);return}i.value=[],k.start(e)}function y(e){i.value=[],k.rerun(e)}const _=e=>{if(f.value.length){for(let o=0;o<f.value.length;o++)oe("error",f.value[o]);return}i.value=[],k.startInNewTab(e)},$=E(()=>{let e=`/download/backtest/tradingview/${d.results.generalInfo.session_id}?token=${b}`;return x.value!=="/"&&(e=x.value+e),e});E(()=>{let e=`/download/backtest/full-reports/${d.results.generalInfo.session_id}?token=${b}`;return x.value!=="/"&&(e=x.value+e),e});const L=E(()=>{let e=`/download/backtest/csv/${d.results.generalInfo.session_id}?token=${b}`;return x.value!=="/"&&(e=x.value+e),e}),O=E(()=>{let e=`/download/backtest/json/${d.results.generalInfo.session_id}?token=${b}`;return x.value!=="/"&&(e=x.value+e),e}),N=E(()=>k.formattedMetrics(w.value).length>0),re=E(()=>J.remainingTimeText(d.results.progressbar.estimated_remaining_seconds));function ae(){try{i.value.length>1e6&&oe("success","Copying large log file, please wait..."),setTimeout(()=>{navigator.clipboard.writeText(i.value.join(`
`)),oe("success","Logs copied successfully"),u.value=!0,setTimeout(()=>{u.value=!1},3e3)},0)}catch{oe("error","Failed to copy logs")}}async function ne(){const e=k.missingCandlesErrors[w.value];e&&(P.forms.push({id:J.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}}),await dt("/candles/"),await P.start(P.forms[P.forms.length-1].id))}async function I(){i.value.length===0?await V():n.value=!0}async function V(){p.value=!0;try{const{data:e,error:o}=await ut(`/backtest/logs/${w.value}?token=${b}`,!1);if(o.value){oe("error",o.value.message),p.value=!1;return}const F=e.value;setTimeout(()=>{const K=J.decompressData(F.content).split(`
`).map(ee=>{const S=ee.match(/\[INFO \| (.*?)\] (.*)/);return S?`[${S[1]}] ${S[2]}`:ee});i.value=K,p.value=!1,n.value=!0},0)}catch{oe("error","Failed to fetch logs"),p.value=!1}}async function z(){let e=`/backtest/download-log/${w.value}?token=${b}`;x.value!=="/"&&(e=x.value+e),window.open(e,"_blank")}return(e,o)=>{const F=Et,W=tt,K=lt,ee=vt,S=ge,ce=pt,be=ht,te=at,Ve=wt,Ie=yt,Te=nt,se=it,De=Ot,Se=rt,Ae=Pt,he=_t,Fe=Ct,We=gt,qe=bt;return r(),m(H,null,[a(K,{modelValue:l(n),"onUpdate:modelValue":o[0]||(o[0]=v=>fe(n)?n.value=v:null),title:"Logs"},{default:R(()=>[a(F,{logs:l(i)},null,8,["logs"])]),buttons:R(()=>[a(W,{text:"Copy",class:"inline-block",popper:{arrow:!0}},{default:R(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:ae},[l(u)?(r(),U(l(st),{key:0,class:"h-6 w-6","aria-hidden":"true"})):h("",!0),!l(u)&&l(i).length!=0?(r(),U(l(mt),{key:1,class:"h-6 w-6","aria-hidden":"true"})):h("",!0)])]),_:1}),a(W,{text:"Download",class:"inline-block ml-2",popper:{arrow:!0}},{default:R(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:z},[l(i).length!=0?(r(),U(l(ot),{key:0,class:"h-6 w-6","aria-hidden":"true"})):h("",!0)])]),_:1})]),_:1},8,["modelValue"]),e.results.executing&&!e.results.showResults?(r(),m("div",ws,[s("div",null,[a(ee,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?h("",!0):(r(),m("h3",{key:0,class:"mt-8 animate-pulse",textContent:C(l(re))},null,8,ks)),s("div",xs,[s("div",_s,[e.results.exception.error?(r(),U(S,{key:0,color:"primary",class:"w-64 flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Retry",trailing:!1,onClick:o[1]||(o[1]=v=>l(ve)((e._.provides[de]||e.$route).params.id))})):h("",!0),a(S,{color:"gray",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},class:"w-64 flex justify-center",icon:"i-heroicons-no-symbol",size:"xl",variant:"solid",label:"Cancel",trailing:!1,onClick:o[2]||(o[2]=v=>l(X)((e._.provides[de]||e.$route).params.id))})]),e.form.debug_mode&&e.results.exception.error?(r(),m("div",Cs,[a(S,{icon:"i-heroicons-clipboard-document-list",label:"Debugging Logs",color:"gray",size:"xl",variant:"solid",trailing:!1,class:"w-64 flex justify-center",onClick:I})])):h("",!0)]),e.results.exception.error&&e.results.executing?(r(),m("div",$s,[a(ce,{modelValue:l(t),"onUpdate:modelValue":o[3]||(o[3]=v=>fe(t)?t.value=v:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"backtest","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):h("",!0)])):h("",!0),a(qe,null,{left:R(()=>[!e.results.executing&&!e.results.showResults?(r(),m("div",Vs,[l(k).missingCandlesErrors[l(w)]?(r(),U(be,{key:0,icon:"i-heroicons-exclamation-triangle",color:"rose",variant:"soft",class:"mb-4"},{title:R(()=>o[25]||(o[25]=[s("h3",{class:"text-lg font-semibold"},"Missing Required Warmup Candles",-1)])),description:R(()=>[s("p",Ts,[o[26]||(o[26]=ke(" Your strategy requires ")),o[27]||(o[27]=s("strong",{class:"font-bold"},"warmup candles",-1)),ke(' for "'+C(l(k).missingCandlesErrors[l(w)].symbol)+'" on "'+C(l(k).missingCandlesErrors[l(w)].exchange)+'" starting from "'+C(l(k).missingCandlesErrors[l(w)].start_date)+'". These candles are needed for proper strategy initialization. ',1)]),a(S,{label:"Import Required Candles",icon:"i-heroicons-arrow-down-tray",onClick:ne})]),_:1})):h("",!0),a(te,{class:"mb-4",title:"Exchange"}),a(Ve,{modelValue:e.form.exchange,"onUpdate:modelValue":o[4]||(o[4]=v=>e.form.exchange=v),placeholder:"Select an exchange...",searchable:"",options:l(we)().backtestingExchangeNames,size:"lg",class:"mt-2 mb-16"},null,8,["modelValue","options"]),a(Ie,{"total-routes-error":l(f),timeframes:l(Y),form:e.form,results:e.results,symbols:l(B),mode:"backtest"},null,8,["total-routes-error","timeframes","form","results","symbols"]),a(te,{class:"mt-16",title:"Duration"}),s("div",Ss,[a(Te,{modelValue:e.form.start_date,"onUpdate:modelValue":o[5]||(o[5]=v=>e.form.start_date=v),type:"date",variant:"outline",size:"lg",class:"w-full mr-2"},null,8,["modelValue"]),a(Te,{modelValue:e.form.finish_date,"onUpdate:modelValue":o[6]||(o[6]=v=>e.form.finish_date=v),type:"date",variant:"outline",size:"lg",class:"w-full ml-2"},null,8,["modelValue"])]),a(te,{class:"mt-16",title:"Options"}),s("div",js,[a(se,{modelValue:e.form.debug_mode,"onUpdate:modelValue":o[7]||(o[7]=v=>e.form.debug_mode=v),title:"Debug Mode",description:"Logs every step of the execution. Very helpful for debugging your strategy but takes a lot longer to execute"},null,8,["modelValue"]),a(se,{modelValue:e.form.export_chart,"onUpdate:modelValue":o[8]||(o[8]=v=>e.form.export_chart=v),title:"Generate Interactive Charts",description:"Generate interactive charts for backtest results with details."},null,8,["modelValue"]),a(se,{modelValue:e.form.export_tradingview,"onUpdate:modelValue":o[9]||(o[9]=v=>e.form.export_tradingview=v),title:"Export Tradingview",description:"Exports the executed trades in a format accepted by TradingView's Pine Editor. Useful to look at the executed orders on their chart."},null,8,["modelValue"]),a(se,{modelValue:e.form.export_csv,"onUpdate:modelValue":o[10]||(o[10]=v=>e.form.export_csv=v),title:"Export CSV",description:"Exports executed trades in a CSV format"},null,8,["modelValue"]),a(se,{modelValue:e.form.export_json,"onUpdate:modelValue":o[11]||(o[11]=v=>e.form.export_json=v),title:"Export JSON",description:"Exports executed trades in a JSON format"},null,8,["modelValue"]),a(se,{modelValue:e.form.fast_mode,"onUpdate:modelValue":o[12]||(o[12]=v=>e.form.fast_mode=v),title:"Fast Mode",description:"Runs the backtest faster by using an improved algorithm. This is supposed to yield the same results; however, it's currently experimental, which is why it's an option."},null,8,["modelValue"]),a(se,{modelValue:e.form.benchmark,"onUpdate:modelValue":o[13]||(o[13]=v=>e.form.benchmark=v),title:"Benchmark",description:"If enabled, the backtest will compare the performance of the strategy against the buy and hold strategy of the market."},null,8,["modelValue"])])])):h("",!0),e.results.showResults?(r(),m("div",Ls,[s("div",null,[l(N)?(r(),U(te,{key:0,class:"mb-4",title:"Equity Curve"})):h("",!0),l(N)?(r(),U(De,{key:1,data:e.results.charts.equity_curve},null,8,["data"])):h("",!0),l(N)?(r(),U(te,{key:2,class:"mt-16 mb-4",title:"Performance"})):h("",!0),l(N)?(r(),U(Se,{key:3,data:l(k).formattedMetrics(l(w))},null,8,["data"])):h("",!0),l(N)?h("",!0):(r(),m("div",Rs," No trades were executed via this strategy! "))]),a(Ae,{modelValue:l(g),"onUpdate:modelValue":o[17]||(o[17]=v=>fe(g)?g.value=v:null)},{title:R(()=>[s("div",Es,[a(Ve,{modelValue:e.results.selectedRoute,"onUpdate:modelValue":o[14]||(o[14]=v=>e.results.selectedRoute=v),"value-attribute":"value",options:l(D)},null,8,["modelValue","options"]),a(S,{class:"ml-2",color:"gray",label:l(c)?"Hide Trades":"Show Trades",onClick:o[15]||(o[15]=v=>c.value=!l(c))},null,8,["label"])])]),default:R(()=>[a(hs,{modelValue:l(c),"onUpdate:modelValue":o[16]||(o[16]=v=>fe(c)?c.value=v:null),results:e.results,form:e.form},null,8,["modelValue","results","form"])]),_:1},8,["modelValue"])])):h("",!0)]),right:R(()=>[e.results.executing?h("",!0):(r(),m("div",zs,[e.results.showResults?(r(),m("div",Us,[a(S,{class:"w-full flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Rerun",trailing:!1,onClick:o[18]||(o[18]=v=>y((e._.provides[de]||e.$route).params.id))}),a(S,{class:"w-full flex justify-center mt-4",color:"green",icon:"i-heroicons-arrow-uturn-left",size:"xl",variant:"solid",label:"New session",trailing:!1,onClick:o[19]||(o[19]=v=>l(le)((e._.provides[de]||e.$route).params.id))}),e.form.debug_mode?(r(),U(S,{key:0,class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-clipboard-document-list",size:"xl",variant:"solid",label:"Debugging Logs",loading:l(p),trailing:!1,onClick:o[20]||(o[20]=v=>I())},null,8,["loading"])):h("",!0),e.form.export_chart?(r(),U(S,{key:1,class:"mt-4 flex justify-center items-center btn-secondary text-center",color:"gray",icon:"i-heroicons-chart-bar",size:"xl",block:"",variant:"solid",label:"View charts",trailing:!1,onClick:o[21]||(o[21]=v=>g.value=!0)})):h("",!0),e.form.export_csv&&l(N)?(r(),m("a",{key:2,href:l(L),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[a(S,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"CSV",trailing:!1})],8,Os)):h("",!0),e.form.export_json&&l(N)?(r(),m("a",{key:3,href:l(O),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[a(S,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"JSON",trailing:!1})],8,Ms)):h("",!0),e.form.export_tradingview&&l(N)?(r(),m("a",{key:4,href:l($),target:"_blank",class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[a(S,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"TradingView Pine Editor",trailing:!1})],8,Ps)):h("",!0),e.results.showResults&&e.results.alert&&e.results.alert.message?(r(),m("div",Bs,[a(be,{color:"teal",icon:"i-heroicons-check-circle",variant:"soft",title:e.results.alert.message,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"white",variant:"link"},onClose:o[22]||(o[22]=v=>e.results.alert.message="")},null,8,["title"])])):h("",!0),a(he,{class:"mt-8 mb-4",size:"lg",label:"General Info"}),a(Fe,{data:e.results.info},null,8,["data"]),a(he,{class:"mt-8 mb-4",size:"lg",label:"Routes"}),a(We,{data:e.results.routes_info,"header-items":["Symbol","Timeframe","Strategy"],header:""},null,8,["data"]),e.results.hyperparameters.length?(r(),U(he,{key:6,class:"mt-8 mb-4",size:"lg",label:"Hyperparameters"})):h("",!0),e.results.hyperparameters.length?(r(),U(Se,{key:7,data:e.results.hyperparameters},null,8,["data"])):h("",!0)])):(r(),m("div",Ns,[a(S,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",size:"xl",variant:"solid",label:"Start",trailing:!1,onClick:o[23]||(o[23]=v=>ye((e._.provides[de]||e.$route).params.id))}),a(S,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-plus",size:"xl",variant:"solid",label:"Start in a new tab",trailing:!1,onClick:o[24]||(o[24]=v=>_((e._.provides[de]||e.$route).params.id))})]))]))]),_:1})],64)}}}),Ds={class:"w-full"},Ks=Z({__name:"[id]",setup(M){Vt({title:"Backtest - Jesse"});const d=Ne(),p=E(()=>d.tabs),c=E(()=>ct().params.id),n=E(()=>{if(!p.value[c.value]){const i=Object.keys(p.value);if(i.length>0){const f=p.value[i[0]];return ft().push(`/backtest/${f.id}`),f}}return p.value[c.value]});return Object.keys(p.value).length===0&&d.addTab(),$t({w:()=>{n.value&&d.closeTabsFromCurrent(n.value.id)},ArrowLeft:()=>d.goToPrevTab(c.value),ArrowRight:()=>d.goToNextTab(c.value)}),(i,f)=>{const t=He,u=Is;return r(),m(H,null,[s("div",Ds,[a(t,{"current-tab":n.value?n.value.id:null,tabs:p.value,onClose:l(d).closeTab,onCancel:l(d).cancel},null,8,["current-tab","tabs","onClose","onCancel"])]),n.value?(r(),U(u,{key:0,form:n.value.form,results:n.value.results},null,8,["form","results"])):h("",!0)],64)}}});export{Ks as default};
