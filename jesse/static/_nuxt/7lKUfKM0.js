import{_ as Ae}from"./CNaQQh5s.js";import{T as be,r as Fe,_ as He,a as Ye,b as Je,c as Qe,d as Ge}from"./D0BSnZOe.js";import{g as ee,h as Ee,i as T,r as R,j as K,k as ke,l as ze,c as m,o as a,F as W,b as s,m as ge,n as Ze,t as w,p as xe,q as L,w as S,d as r,s as Xe,v as Ve,x as _e,y as Ue,z as b,A as l,B as D,C as B,D as ne,E as Se,G as Ke,H as Oe,I as de,e as he,J as we,K as Me,L as X,M as me,N as je,O as Pe,P as et,Q as tt,R as st,S as ot,T as lt,U as ie,V as rt,W as at,X as nt,Y as it,Z as pe,$ as dt,a0 as ut,a1 as ct,a2 as ft}from"./BbUh6qYj.js";import{_ as mt}from"./D7y4u6st.js";import{_ as pt}from"./BnV_BqlS.js";import{s as Te,l as vt,d as gt}from"./lA_J2Fq2.js";import{_ as yt}from"./DTJjRTnG.js";import{s as ve,l as Le,d as Re,_ as bt,a as ht}from"./Bx9UN7iD.js";import{u as wt}from"./WI5VG1n5.js";import"./CMHzYZyX.js";import"./CjbpaSlu.js";const kt={class:"mt-2"},xt={class:"ml-2"},_t=ee({__name:"EquityCurve",props:{data:{}},setup(O){const d=Ee(),p=T(()=>d.value),f=R();let n=null,y=[];const c=O;K(c.data,g=>{}),K(p,g=>{k(g)}),ke(async()=>{await t()});async function t(){Te.width=f.value.clientWidth,n=be(f.value,Te);for(const g of c.data){const i=n.addLineSeries({lineWidth:2});i.setData(g.data),y.push(i)}n.timeScale().fitContent(),k(p.value)}ze(()=>{v()});function v(){n!==null&&(n.remove(),n=null),y&&(y=[])}function k(g){n===null||y===null||n.applyOptions(g==="light"?vt.chart:gt.chart)}return(g,i)=>(a(),m(W,null,[s("div",{ref_key:"chartContainer",ref:f,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),s("div",kt,[(a(!0),m(W,null,ge(g.data,_=>(a(),m("span",{key:_.name,class:"text-xs mr-2 rounded bg-white dark:bg-gray-700 p-1"},[s("span",{class:"inline-block",style:Ze({backgroundColor:_.color,width:"25px",height:"10px"})},null,4),s("span",xt,w(_.name),1)]))),128))])],64))}}),Ct={class:"flex items-center justify-between"},$t=ee({__name:"FullscreenModal",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(O){const d=xe(O,"modelValue");return(p,f)=>{const n=_e,y=Xe,c=Ue;return a(),L(c,{modelValue:d.value,"onUpdate:modelValue":f[1]||(f[1]=t=>d.value=t),fullscreen:""},{default:S(()=>[r(y,{ui:{base:"h-full flex flex-col",rounded:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",body:{base:"grow"}}},{header:S(()=>[s("div",Ct,[s("div",null,[Ve(p.$slots,"title")]),r(n,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:f[0]||(f[0]=t=>d.value=!1)})])]),default:S(()=>[Ve(p.$slots,"default")]),_:3})]),_:3},8,["modelValue"])}}}),Vt={class:"w-16 overflow-hidden"},St={class:"w-8 overflow-hidden"},jt={key:0,class:"w-full transition-all overflow-hidden duration-300 bg-gray-50 dark:bg-gray-800"},Tt=["onClick"],Lt={class:"w-16 overflow-hidden text-center"},Rt={class:"w-12 overflow-hidden text-center"},Et={class:"w-8 overflow-hidden text-center"},zt={class:"p-4"},Ut={class:"mt-4"},Ot={class:"w-full text-sm"},Mt={class:"w-full"},Pt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},It={class:"w-full flex justify-between py-2 px-4"},Nt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Dt={class:"w-full flex justify-between py-2 px-4"},Bt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Wt={class:"w-full flex justify-between py-2 px-4"},qt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},At={class:"w-full flex justify-between py-2 px-4"},Ft={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Ht={class:"w-full"},Yt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Jt={class:"w-full flex justify-between py-2 px-4"},Qt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Gt={key:0,class:"w-full flex justify-between py-2 px-4"},Zt={key:1,class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Xt={key:2,class:"w-full flex justify-between py-2 px-4"},Kt={class:"flex justify-end mt-4"},es=ee({__name:"ChartOrders",props:{trade:{}},emits:["zoom"],setup(O,{emit:d}){const p=d,f=R(null),n=R(!1),y=R(!1);return(c,t)=>{const v=Ke,k=_e,g=Ue;return a(),m(W,null,[r(k,{variant:"ghost",color:"gray",class:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 text-xs border-b border-gray-100 dark:border-gray-800 rounded-none p-2",onClick:t[1]||(t[1]=i=>y.value=!l(y))},{default:S(()=>[s("div",{class:D(["w-2 transition-all duration-300",[l(y)?"rotate-90":"rotate-0"]])},t[4]||(t[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})],-1)]),2),s("div",Vt,w(l(B).roundPrice(c.trade.entry_price)),1),t[5]||(t[5]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:D(["w-16 overflow-hidden",c.trade.type.toLowerCase()==="long"?"text-green-500":"text-red-500"])},w(l(ne).round(c.trade.qty,2)),3),t[6]||(t[6]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:D([[c.trade.PNL_percentage>0?"text-green-500":"text-red-500"],"w-16 overflow-hidden text-xs"])},w(l(ne).round(c.trade.PNL_percentage,2))+"% ",3),t[7]||(t[7]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",St,[r(k,{color:"gray",size:"xs",onClick:t[0]||(t[0]=Se(i=>p("zoom",c.trade.orders[0].id),["stop"]))},{default:S(()=>[r(v,{name:"i-heroicons-arrow-right"})]),_:1})])]),_:1}),l(y)?(a(),m("div",jt,[t[12]||(t[12]=Oe('<div class="flex justify-between items-center border-b-2 border-gray-200 dark:border-gray-700 px-1 py-2 text-xs"><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PRICE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-12 overflow-hidden italic font-bold uppercase text-center">TYPE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">SIDE</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(a(!0),m(W,null,ge(c.trade.orders,(i,_)=>(a(),m("div",{key:_,class:"w-full flex justify-between items-center hover:bg-gray-200 dark:hover:bg-gray-900 text-xs py-2 border-b border-gray-200 cursor-pointer dark:border-gray-700 px-1",onClick:E=>{f.value=i,n.value=!0}},[s("div",Lt,w(l(B).roundPrice(i.price)),1),t[8]||(t[8]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:D(["w-10 overflow-hidden text-center",i.side==="buy"?"text-green-500":"text-red-500"])},w(l(ne).round(i.qty,2)),3),t[9]||(t[9]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Rt,w(i.type),1),t[10]||(t[10]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:D([[i.side==="buy"?"text-green-500":"text-red-500"],"w-10 overflow-hidden text-center"])},w(i.side.toUpperCase()),3),t[11]||(t[11]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Et,[r(k,{color:"gray",size:"xs",onClick:Se(E=>p("zoom",i.id),["stop"])},{default:S(()=>[r(v,{name:"i-heroicons-arrow-right"})]),_:2},1032,["onClick"])])],8,Tt))),128))])):b("",!0),r(g,{modelValue:l(n),"onUpdate:modelValue":t[3]||(t[3]=i=>de(n)?n.value=i:null)},{default:S(()=>{var i,_,E,U,H,te,q,A,Y,J,se;return[s("div",zt,[s("div",Ut,[s("div",Ot,[t[28]||(t[28]=s("h2",{class:"text-lg mb-2 font-bold italic dark:text-white text-center"}," Trade ",-1)),s("div",Mt,[s("div",Pt,[t[13]||(t[13]=s("div",{class:"font-bold"},"Entry Price",-1)),s("div",null,w(l(B).roundPrice(c.trade.entry_price)),1)]),s("div",It,[t[14]||(t[14]=s("div",{class:"font-bold"},"Exit Price",-1)),s("div",null,w(l(B).roundPrice(c.trade.exit_price)),1)]),s("div",Nt,[t[15]||(t[15]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,w(c.trade.qty),1)]),s("div",Dt,[t[16]||(t[16]=s("div",{class:"font-bold"},"Size",-1)),s("div",null,w(l(B).roundPrice(c.trade.size)),1)]),s("div",Bt,[t[17]||(t[17]=s("div",{class:"font-bold"},"PNL",-1)),s("div",{class:D([c.trade.PNL>0?"text-green-500":"text-red-500"])},w(l(ne).round(c.trade.PNL,2))+" ("+w(l(ne).round(c.trade.PNL_percentage,2))+"%) ",3)]),s("div",Wt,[t[18]||(t[18]=s("div",{class:"font-bold"},"Fee",-1)),s("div",null,w(l(ne).round(c.trade.fee,2)),1)]),s("div",qt,[t[19]||(t[19]=s("div",{class:"font-bold"},"Holding Period",-1)),s("div",null,w(l(B).secondsToHumanReadable(c.trade.holding_period)),1)]),s("div",At,[t[20]||(t[20]=s("div",{class:"font-bold"},"Opened At",-1)),s("div",null,w(new Date(c.trade.opened_at).toLocaleString()),1)]),s("div",Ft,[t[21]||(t[21]=s("div",{class:"font-bold"},"Closed At",-1)),s("div",null,w(new Date(c.trade.closed_at).toLocaleString()),1)])]),t[29]||(t[29]=s("h2",{class:"text-lg font-bold italic dark:text-white mt-6 mb-2 text-center"}," Order ",-1)),s("div",Ht,[s("div",Yt,[t[22]||(t[22]=s("div",{class:"font-bold"},"Side",-1)),s("div",{class:D([((i=l(f))==null?void 0:i.side)==="buy"?"text-green-500":"text-red-500"])},w((E=(_=l(f))==null?void 0:_.side)==null?void 0:E.toUpperCase()),3)]),s("div",Jt,[t[23]||(t[23]=s("div",{class:"font-bold"},"Type",-1)),s("div",null,w((U=l(f))==null?void 0:U.type),1)]),s("div",Qt,[t[24]||(t[24]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,w((H=l(f))==null?void 0:H.qty),1)]),(te=l(f))!=null&&te.created_at?(a(),m("div",Gt,[t[25]||(t[25]=s("div",{class:"font-bold"},"Created At",-1)),s("div",null,w(new Date((q=l(f))==null?void 0:q.created_at).toLocaleString()),1)])):b("",!0),(A=l(f))!=null&&A.executed_at?(a(),m("div",Zt,[t[26]||(t[26]=s("div",{class:"font-bold"},"Executed At",-1)),s("div",null,w(new Date((Y=l(f))==null?void 0:Y.executed_at).toLocaleString()),1)])):b("",!0),(J=l(f))!=null&&J.canceled_at?(a(),m("div",Xt,[t[27]||(t[27]=s("div",{class:"font-bold"},"Canceled At",-1)),s("div",null,w(new Date((se=l(f))==null?void 0:se.canceled_at).toLocaleString()),1)])):b("",!0)])]),s("div",Kt,[r(k,{color:"gray",block:"",onClick:t[2]||(t[2]=ue=>n.value=!1)},{default:S(()=>t[30]||(t[30]=[he(" Close ")])),_:1})])])])]}),_:1},8,["modelValue"])],64)}}}),ts={class:"w-0 sidebar whitespace-nowrap relative transition-all duration-300"},ss={key:1,class:"h-full flex justify-center items-center text-xs text-gray-500"},os=ee({__name:"ChartSidebar",props:we({items:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:we(["zoom"],["update:modelValue"]),setup(O,{emit:d}){const p=xe(O,"modelValue"),f=d;return(n,y)=>{const c=es;return a(),m("div",ts,[s("div",{class:D([p.value?"w-96 p-2":"w-0 p-0","absolute h-full overflow-y-auto border-r-2 dark:border-gray-800 transition-all duration-300 z-0"])},[n.items.length>0?(a(),m(W,{key:0},[y[1]||(y[1]=Oe('<div class="flex justify-between items-center border-b-2 p-2 text-xs dark:border-gray-800"><div class="w-2"></div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">ENTRY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PNL</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(a(!0),m(W,null,ge(n.items,(t,v)=>(a(),m("div",{key:v,class:"w-full"},[r(c,{trade:t,onZoom:y[0]||(y[0]=k=>f("zoom",k))},null,8,["trade"])]))),128))],64)):(a(),m("div",ss," No trades were executed "))],2)])}}}),ls={class:"w-full h-full flex justify-between border-2 border-gray-200 dark:border-gray-800 rounded-lg"},rs={class:"w-full flex flex-col h-full border dark:border-gray-800"},as={key:0},ns=ee({__name:"BacktestCandlesChart",props:we({form:{},results:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(O){const d=Ee(),p=R(2),f=xe(O,"modelValue"),n=O,y=R(),c=R([]);let t=null,v=null;const k=[],g=[],i=T(()=>Me().params.id),_=T(()=>X.extraChartLines[i.value].find(h=>h.symbol===n.results.selectedRoute.symbol)),E=T(()=>d.value),U=T(()=>ue());K(E,h=>{J(h)}),K(()=>n.results.selectedRoute.symbol,()=>{Y(),setTimeout(async()=>{await H()},100)}),ke(async()=>{setTimeout(async()=>{await H()},200)}),K(f,()=>{setTimeout(()=>{te()},300)});async function H(){var oe,le,G,P;ve.width=y.value.clientWidth,ve.height=y.value.clientHeight-Object.keys(_.value.charts).length*150,t=be(y.value,ve),t.applyOptions({rightPriceScale:{borderColor:E.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${n.results.selectedRoute.symbol} • ${n.results.selectedRoute.timeframe}`}}),v=t.addCandlestickSeries();const h=X.candles[i.value].find(x=>x.symbol===n.results.selectedRoute.symbol).candles;v.setData(h),v.setMarkers(X.orders[i.value].find(x=>x.symbol===n.results.selectedRoute.symbol).orders);const C=String(h[0].open).indexOf("."),$=C===-1?0:String(h[h.length-1].open).length-C-1;p.value!==$&&(p.value=$,(p.value<0||p.value>100)&&(p.value=0),v.applyOptions({priceFormat:{type:"price",precision:p.value,minMove:Math.pow(10,-p.value).toFixed(p.value)}}));const M=(le=(oe=X.lines[i.value])==null?void 0:oe.find(x=>x.symbol===n.results.selectedRoute.symbol))==null?void 0:le.lines;if(M)for(const x of Object.keys(M)){const e=M[x];t.addLineSeries({lineWidth:1,title:x}).setData(e.data)}const z=(P=(G=X.horizontalLines[i.value])==null?void 0:G.find(x=>x.symbol===n.results.selectedRoute.symbol))==null?void 0:P.lines;if(z)for(const x of Object.keys(z)){const o=z[x];v.createPriceLine(o)}t.timeScale().fitContent();const Q=new Set;Object.keys(_.value.charts).forEach((x,e)=>{const o={...ve};o.width=c.value[e].clientWidth,o.height=150;const j=be(c.value[e],o);k.push(j),Object.keys(_.value.charts[x]).forEach(I=>{var V,ce;const N=j.addLineSeries({lineWidth:1,title:I}),F=(ce=(V=X.horizontalExtraLines[i.value])==null?void 0:V.find(re=>re.symbol===n.results.selectedRoute.symbol))==null?void 0:ce.lines[x];if(F&&!Q.has(x)){for(const re of Object.keys(F)){const fe=F[re];N.createPriceLine(fe)}Q.add(x)}N.setData(_.value.charts[x][I].data),g.push(N)}),j.applyOptions({rightPriceScale:{borderColor:E.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:x}}),j.timeScale().subscribeVisibleLogicalRangeChange(I=>{t.timeScale().setVisibleLogicalRange(I)}),e!==Object.keys(_.value.charts).length-1&&j.timeScale().applyOptions({visible:!1})}),t.subscribeCrosshairMove(x=>{const e=q(v,x);Object.keys(_.value.charts).forEach((o,j)=>{A(k[j],g[j],e)})}),Object.keys(_.value.charts).forEach((x,e)=>{k[e].subscribeCrosshairMove(o=>{const j=q(g[e],o);A(t,v,j),k.forEach((I,N)=>{N!==e&&A(I,g[N],j)})})}),t.timeScale().subscribeVisibleLogicalRangeChange(x=>{k.forEach(e=>{e.timeScale().setVisibleLogicalRange(x)})}),J(E.value),k.length>0&&t.timeScale().applyOptions({visible:!1})}function te(){var h;t!==null&&(t.applyOptions({width:(h=y.value)==null?void 0:h.clientWidth}),k.forEach(C=>{var $;C.applyOptions({width:($=y.value)==null?void 0:$.clientWidth})}))}ze(()=>{Y()});function q(h,C){return C.time&&C.seriesData.get(h)||null}function A(h,C,$){if($){h.setCrosshairPosition($.value,$.time,C);return}h.clearCrosshairPosition()}function Y(){t!==null&&(t.remove(),t=null),v!==null&&(v=null),k.length>0&&(k.forEach(h=>{h.remove()}),k.length=0),g.length>0&&(g.length=0)}function J(h){t!==null&&(t.applyOptions(h==="light"?Le.chart:Re.chart),k.forEach(C=>{C.applyOptions(h==="light"?Le.chart:Re.chart)}))}function se(h){const C=X.orders[i.value].find(M=>M.symbol===n.results.selectedRoute.symbol).orders,$=C.find(M=>M.order_id===h);if($&&t){const M=(typeof $.time=="number",$.time),z=t.timeScale(),Q=C[1].time-C[0].time,oe=M-Q*5,le=M+Q*5,G=$.color;v==null||v.setMarkers(C.map(P=>P.order_id===h?{...P,color:"#FFA500"}:P)),z.setVisibleRange({from:oe,to:le}),setTimeout(()=>{v==null||v.setMarkers(C.map(P=>P.order_id===h?{...P,color:G}:P))},2e3)}}function ue(){return n.results.trades.filter(h=>h.symbol===n.results.selectedRoute.symbol)}return(h,C)=>(a(),m("div",ls,[r(os,{modelValue:f.value,"onUpdate:modelValue":C[0]||(C[0]=$=>f.value=$),items:l(U),onZoom:C[1]||(C[1]=$=>se($))},null,8,["modelValue","items"]),s("div",{class:D([[f.value?"w-[calc(100%-384px)]":"w-full"],"h-full transition-all duration-300"])},[s("div",rs,[s("div",{ref_key:"chartContainer",ref:y,class:"rounded overflow-hidden flex-grow"},null,512),l(_)&&Object.keys(l(_).charts).length?(a(),m("div",as,[(a(!0),m(W,null,ge(Object.keys(l(_).charts),$=>(a(),m("div",{key:$,ref_for:!0,ref_key:"extraChartsRef",ref:c,class:"relative border-t-[1.5px] dark:border-gray-800"}))),128))])):b("",!0)])],2)]))}}),is={key:0,class:"flex flex-col items-center justify-center select-none mt-[10%]"},ds=["textContent"],us={class:"mt-8"},cs={class:"mt-8 flex flex-col gap-4"},fs={key:0,class:"mt-4"},ms={key:1,class:"mx-auto container mt-8"},ps={key:0},vs={class:"mb-4 mt-4"},gs={class:"flex items-center select-none flex-1 my-4"},ys={class:"grid grid-cols-1 gap-6 mt-8"},bs={key:1,class:"w-full mx-auto"},hs={key:4,class:"text-yellow-500 border-yellow-400 bg-yellow-50 dark:bg-gray-700 dark:text-yellow-400 mt-16 text-center text-2xl rounded border-2 border-dashed dark:border-gray-800 py-16 select-none"},ws={class:"flex justify-start"},ks={key:0},xs={key:0},_s=["href"],Cs=["href"],$s=["href"],Vs={key:5,class:"my-4"},Ss={key:1},js=ee({__name:"BacktestTab",props:{form:{},results:{}},setup(O){const d=O,p=R(!0),f=R(!1),n=R([]),y=R(!1),c=R(!1),t=me().authToken,v=R(je().public.apiBaseUrl),k=R(!1),g=T(()=>Me().params.id),i=Pe(),_=me(),E=et(),U=R([]),H=T(()=>_.jesseSupportedTimeframes.map(e=>({label:e,value:e}))),te=T(()=>d.form.routes.map(e=>({label:`${e.strategy} • ${e.symbol}`,value:e})));d.results.selectedRoute=d.form.routes[0],ke(async()=>{await _.initiate(),!d.form.exchange&&_.backtestingExchangeNames.length&&(d.form.exchange=_.backtestingExchangeNames[0]),(!d.results.showResults&&d.form.exchange||!U.value.length)&&await q()});async function q(){if(d.form.exchange)try{U.value=await _.getExchangeSupportedSymbols(d.form.exchange);for(let e=0;e<d.form.routes.length;e++)U.value.includes(d.form.routes[e].symbol)||(d.form.routes[e].symbol=U.value[0]);if(d.form.data_routes.length>0)for(let e=0;e<d.form.data_routes.length;e++)U.value.includes(d.form.data_routes[e].symbol)||(d.form.data_routes[e].symbol=U.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}K(()=>d.form.exchange,async(e,o)=>{e!==o&&(U.value=[],await q())});const{cancel:A,rerun:Y,newBacktest:J,retry:se}=i;function ue(e){if(n.value.length){for(let o=0;o<n.value.length;o++)pe("error",n.value[o]);return}i.start(e)}const h=e=>{if(n.value.length){for(let o=0;o<n.value.length;o++)pe("error",n.value[o]);return}i.startInNewTab(e)},C=T(()=>{let e=`/download/backtest/tradingview/${d.results.generalInfo.session_id}?token=${t}`;return v.value!=="/"&&(e=v.value+e),e});T(()=>{let e=`/download/backtest/full-reports/${d.results.generalInfo.session_id}?token=${t}`;return v.value!=="/"&&(e=v.value+e),e});const $=T(()=>{let e=`/download/backtest/csv/${d.results.generalInfo.session_id}?token=${t}`;return v.value!=="/"&&(e=v.value+e),e}),M=T(()=>{let e=`/download/backtest/json/${d.results.generalInfo.session_id}?token=${t}`;return v.value!=="/"&&(e=v.value+e),e}),z=T(()=>i.formattedMetrics(g.value).length>0),Q=T(()=>B.remainingTimeText(d.results.progressbar.estimated_remaining_seconds));function oe(){navigator.clipboard.writeText(i.getInfoLogs(g.value)),pe("success","Logs copied successfully"),c.value=!0,setTimeout(()=>{c.value=!1},3e3)}K(()=>d.form.start_date,e=>{d.form.finish_date<e&&(d.form.finish_date=e)});async function le(){const e=i.missingCandlesErrors[g.value];e&&(E.forms.push({id:B.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}}),await dt("/candles/"),await E.start(E.forms[E.forms.length-1].id))}async function G(){i.getInfoLogs(g.value).length>0||await P(),f.value=!0}async function P(){const{data:e,error:o}=await ut(`/backtest/logs/${g.value}?token=${t}`,!1);if(o.value){pe("error",o.value.message);return}const j=e.value,N=B.decompressData(j.content).split(`
`).map(F=>{const V=F.match(/\[INFO \| (.*?)\] (.*)/);return V?`[${V[1]}] ${V[2]}`:F}).join(`
`);i.setInfoLogs(g.value,N)}async function x(){const e=je().public.apiBaseUrl,o=me().authToken,j=`${e}/backtest/download-log/${g.value}?token=${o}`;window.open(j,"_blank")}return(e,o)=>{const j=He,I=tt,N=lt,F=Ye,V=_e,ce=Je,re=mt,ae=at,fe=pt,Ie=Qe,Ce=nt,Z=it,Ne=_t,$e=rt,De=$t,ye=yt,Be=bt,We=ht,qe=Ge;return a(),m(W,null,[r(N,{modelValue:l(f),"onUpdate:modelValue":o[0]||(o[0]=u=>de(f)?f.value=u:null),title:"Logs"},{default:S(()=>[r(j,{logs:l(i).getInfoLogs(l(g))},null,8,["logs"])]),buttons:S(()=>[r(I,{text:"Copy",class:"inline-block",popper:{arrow:!0}},{default:S(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:oe},[l(c)?(a(),L(l(st),{key:0,class:"h-6 w-6","aria-hidden":"true"})):b("",!0),!l(c)&&l(i).getInfoLogs(l(g)).length!=0?(a(),L(l(Fe),{key:1,class:"h-6 w-6","aria-hidden":"true"})):b("",!0)])]),_:1}),r(I,{text:"Download",class:"inline-block ml-2",popper:{arrow:!0}},{default:S(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:x},[l(i).getInfoLogs(l(g)).length!=0?(a(),L(l(ot),{key:0,class:"h-6 w-6","aria-hidden":"true"})):b("",!0)])]),_:1})]),_:1},8,["modelValue"]),e.results.executing&&!e.results.showResults?(a(),m("div",is,[s("div",null,[r(F,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?b("",!0):(a(),m("h3",{key:0,class:"mt-8 animate-pulse",textContent:w(l(Q))},null,8,ds)),s("div",us,[s("div",cs,[e.results.exception.error?(a(),L(V,{key:0,color:"primary",class:"w-64 flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Retry",trailing:!1,onClick:o[1]||(o[1]=u=>l(se)((e._.provides[ie]||e.$route).params.id))})):b("",!0),r(V,{color:"gray",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},class:"w-64 flex justify-center",icon:"i-heroicons-no-symbol",size:"xl",variant:"solid",label:"Cancel",trailing:!1,onClick:o[2]||(o[2]=u=>l(A)((e._.provides[ie]||e.$route).params.id))})]),e.form.debug_mode&&e.results.exception.error?(a(),m("div",fs,[r(V,{icon:"i-heroicons-clipboard-document-list",label:"Debugging Logs",color:"gray",size:"xl",variant:"solid",trailing:!1,class:"w-64 flex justify-center",onClick:G})])):b("",!0)]),e.results.exception.error&&e.results.executing?(a(),m("div",ms,[r(ce,{modelValue:l(y),"onUpdate:modelValue":o[3]||(o[3]=u=>de(y)?y.value=u:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"backtest","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):b("",!0)])):b("",!0),r(qe,null,{left:S(()=>[!e.results.executing&&!e.results.showResults?(a(),m("div",ps,[l(i).missingCandlesErrors[l(g)]?(a(),L(re,{key:0,icon:"i-heroicons-exclamation-triangle",color:"rose",variant:"soft",class:"mb-4"},{title:S(()=>o[25]||(o[25]=[s("h3",{class:"text-lg font-semibold"},"Missing Required Warmup Candles",-1)])),description:S(()=>[s("p",vs,[o[26]||(o[26]=he(" Your strategy requires ")),o[27]||(o[27]=s("strong",{class:"font-bold"},"warmup candles",-1)),he(' for "'+w(l(i).missingCandlesErrors[l(g)].symbol)+'" on "'+w(l(i).missingCandlesErrors[l(g)].exchange)+'" starting from "'+w(l(i).missingCandlesErrors[l(g)].start_date)+'". These candles are needed for proper strategy initialization. ',1)]),r(V,{label:"Import Required Candles",icon:"i-heroicons-arrow-down-tray",onClick:le})]),_:1})):b("",!0),r(ae,{class:"mb-4",title:"Exchange"}),r(fe,{modelValue:e.form.exchange,"onUpdate:modelValue":o[4]||(o[4]=u=>e.form.exchange=u),placeholder:"Select an exchange...",searchable:"",options:l(me)().backtestingExchangeNames,size:"lg",class:"mt-2 mb-16"},null,8,["modelValue","options"]),r(Ie,{"total-routes-error":l(n),timeframes:l(H),form:e.form,results:e.results,symbols:l(U),mode:"backtest"},null,8,["total-routes-error","timeframes","form","results","symbols"]),r(ae,{class:"mt-16",title:"Duration"}),s("div",gs,[r(Ce,{modelValue:e.form.start_date,"onUpdate:modelValue":o[5]||(o[5]=u=>e.form.start_date=u),type:"date",variant:"outline",size:"lg",class:"w-full mr-2"},null,8,["modelValue"]),r(Ce,{modelValue:e.form.finish_date,"onUpdate:modelValue":o[6]||(o[6]=u=>e.form.finish_date=u),type:"date",variant:"outline",size:"lg",class:"w-full ml-2"},null,8,["modelValue"])]),r(ae,{class:"mt-16",title:"Options"}),s("div",ys,[r(Z,{modelValue:e.form.debug_mode,"onUpdate:modelValue":o[7]||(o[7]=u=>e.form.debug_mode=u),title:"Debug Mode",description:"Logs every step of the execution. Very helpful for debugging your strategy but takes a lot longer to execute"},null,8,["modelValue"]),r(Z,{modelValue:e.form.export_chart,"onUpdate:modelValue":o[8]||(o[8]=u=>e.form.export_chart=u),title:"Generate Interactive Charts",description:"Generate interactive charts for backtest results with details."},null,8,["modelValue"]),r(Z,{modelValue:e.form.export_tradingview,"onUpdate:modelValue":o[9]||(o[9]=u=>e.form.export_tradingview=u),title:"Export Tradingview",description:"Exports the executed trades in a format accepted by TradingView's Pine Editor. Useful to look at the executed orders on their chart."},null,8,["modelValue"]),r(Z,{modelValue:e.form.export_csv,"onUpdate:modelValue":o[10]||(o[10]=u=>e.form.export_csv=u),title:"Export CSV",description:"Exports executed trades in a CSV format"},null,8,["modelValue"]),r(Z,{modelValue:e.form.export_json,"onUpdate:modelValue":o[11]||(o[11]=u=>e.form.export_json=u),title:"Export JSON",description:"Exports executed trades in a JSON format"},null,8,["modelValue"]),r(Z,{modelValue:e.form.fast_mode,"onUpdate:modelValue":o[12]||(o[12]=u=>e.form.fast_mode=u),title:"Fast Mode",description:"Runs the backtest faster by using an improved algorithm. This is supposed to yield the same results; however, it's currently experimental, which is why it's an option."},null,8,["modelValue"]),r(Z,{modelValue:e.form.benchmark,"onUpdate:modelValue":o[13]||(o[13]=u=>e.form.benchmark=u),title:"Benchmark",description:"If enabled, the backtest will compare the performance of the strategy against the buy and hold strategy of the market."},null,8,["modelValue"])])])):b("",!0),e.results.showResults?(a(),m("div",bs,[s("div",null,[l(z)?(a(),L(ae,{key:0,class:"mb-4",title:"Equity Curve"})):b("",!0),l(z)?(a(),L(Ne,{key:1,data:e.results.charts.equity_curve},null,8,["data"])):b("",!0),l(z)?(a(),L(ae,{key:2,class:"mt-16 mb-4",title:"Performance"})):b("",!0),l(z)?(a(),L($e,{key:3,data:l(i).formattedMetrics(l(g))},null,8,["data"])):b("",!0),l(z)?b("",!0):(a(),m("div",hs," No trades were executed via this strategy! "))]),r(De,{modelValue:l(k),"onUpdate:modelValue":o[17]||(o[17]=u=>de(k)?k.value=u:null)},{title:S(()=>[s("div",ws,[r(fe,{modelValue:e.results.selectedRoute,"onUpdate:modelValue":o[14]||(o[14]=u=>e.results.selectedRoute=u),"value-attribute":"value",options:l(te)},null,8,["modelValue","options"]),r(V,{class:"ml-2",color:"gray",label:l(p)?"Hide Trades":"Show Trades",onClick:o[15]||(o[15]=u=>p.value=!l(p))},null,8,["label"])])]),default:S(()=>[r(ns,{modelValue:l(p),"onUpdate:modelValue":o[16]||(o[16]=u=>de(p)?p.value=u:null),results:e.results,form:e.form},null,8,["modelValue","results","form"])]),_:1},8,["modelValue"])])):b("",!0)]),right:S(()=>[e.results.executing?b("",!0):(a(),m("div",ks,[e.results.showResults?(a(),m("div",xs,[r(V,{class:"w-full flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Rerun",trailing:!1,onClick:o[18]||(o[18]=u=>l(Y)((e._.provides[ie]||e.$route).params.id))}),r(V,{class:"w-full flex justify-center mt-4",color:"green",icon:"i-heroicons-arrow-uturn-left",size:"xl",variant:"solid",label:"New session",trailing:!1,onClick:o[19]||(o[19]=u=>l(J)((e._.provides[ie]||e.$route).params.id))}),e.form.debug_mode?(a(),L(V,{key:0,class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-clipboard-document-list",size:"xl",variant:"solid",label:"Debugging Logs",trailing:!1,onClick:o[20]||(o[20]=u=>G())})):b("",!0),e.form.export_chart?(a(),L(V,{key:1,class:"mt-4 flex justify-center items-center btn-secondary text-center",color:"gray",icon:"i-heroicons-chart-bar",size:"xl",block:"",variant:"solid",label:"View charts",trailing:!1,onClick:o[21]||(o[21]=u=>k.value=!0)})):b("",!0),e.form.export_csv&&l(z)?(a(),m("a",{key:2,href:l($),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[r(V,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"CSV",trailing:!1})],8,_s)):b("",!0),e.form.export_json&&l(z)?(a(),m("a",{key:3,href:l(M),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[r(V,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"JSON",trailing:!1})],8,Cs)):b("",!0),e.form.export_tradingview&&l(z)?(a(),m("a",{key:4,href:l(C),target:"_blank",class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[r(V,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"TradingView Pine Editor",trailing:!1})],8,$s)):b("",!0),e.results.showResults&&e.results.alert&&e.results.alert.message?(a(),m("div",Vs,[r(re,{color:"teal",icon:"i-heroicons-check-circle",variant:"soft",title:e.results.alert.message,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"white",variant:"link"},onClose:o[22]||(o[22]=u=>e.results.alert.message="")},null,8,["title"])])):b("",!0),r(ye,{class:"mt-8 mb-4",size:"lg",label:"General Info"}),r(Be,{data:e.results.info},null,8,["data"]),r(ye,{class:"mt-8 mb-4",size:"lg",label:"Routes"}),r(We,{data:e.results.routes_info,"header-items":["Symbol","Timeframe","Strategy"],header:""},null,8,["data"]),e.results.hyperparameters.length?(a(),L(ye,{key:6,class:"mt-8 mb-4",size:"lg",label:"Hyperparameters"})):b("",!0),e.results.hyperparameters.length?(a(),L($e,{key:7,data:e.results.hyperparameters},null,8,["data"])):b("",!0)])):(a(),m("div",Ss,[r(V,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",size:"xl",variant:"solid",label:"Start",trailing:!1,onClick:o[23]||(o[23]=u=>ue((e._.provides[ie]||e.$route).params.id))}),r(V,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-plus",size:"xl",variant:"solid",label:"Start in a new tab",trailing:!1,onClick:o[24]||(o[24]=u=>h((e._.provides[ie]||e.$route).params.id))})]))]))]),_:1})],64)}}}),Ts={class:"w-full"},Bs=ee({__name:"[id]",setup(O){wt({title:"Backtest - Jesse"});const d=Pe(),p=T(()=>d.tabs),f=T(()=>ct().params.id),n=T(()=>{if(!p.value[f.value]){const y=Object.keys(p.value);if(y.length>0){const c=p.value[y[0]];return ft().push(`/backtest/${c.id}`),c}}return p.value[f.value]});return Object.keys(p.value).length===0&&d.addTab(),(y,c)=>{const t=Ae,v=js;return a(),m(W,null,[s("div",Ts,[r(t,{"current-tab":n.value?n.value.id:null,tabs:p.value,mode:"backtest",onClose:l(d).closeTab,onCancel:l(d).cancel},null,8,["current-tab","tabs","onClose","onCancel"])]),n.value?(a(),L(v,{key:0,form:n.value.form,results:n.value.results},null,8,["form","results"])):b("",!0)],64)}}});export{Bs as default};
