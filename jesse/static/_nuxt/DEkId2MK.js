import{_ as Ye}from"./0FU3uyTq.js";import{_ as Je}from"./BfoYcfRl.js";import{g as Q,r as C,h as R,i as J,n as Qe,j as Ge,c,o as r,k as z,l as y,d as a,m as W,b as s,t as x,F as q,p as me,q as be,s as Oe,v as _e,x as Me,y as Ze,z as $e,w as L,A as Xe,B as Te,C as Pe,D as l,E as Y,G as ie,H as Le,I as Ke,J as Be,K as fe,e as we,L as ke,M as Ne,N as se,O as ge,P as Re,Q as Ie,R as et,S as tt,T as st,U as ot,V as lt,W as de,X as rt,Y as at,Z as nt,$ as it,a0 as oe,a1 as dt,a2 as ut,a3 as ct,a4 as ft}from"./CwIBBHLx.js";import{T as xe,r as mt,_ as pt,a as vt,b as gt,c as yt,d as bt}from"./BVJb5ImL.js";import{_ as ht}from"./DjVS2MLA.js";import{_ as wt}from"./C-cHy49p.js";import{s as Ee,l as kt,d as xt}from"./lA_J2Fq2.js";import{_ as _t}from"./DCC2M23c.js";import{s as ye,l as ze,d as Ue,_ as $t}from"./OiX_PJh-.js";import{u as Ct}from"./DqVFCpIs.js";import"./COV5UaG3.js";const Vt={class:"w-full h-full flex flex-col"},St={key:0,class:"flex justify-center items-center py-8"},jt={class:"w-full relative"},Tt={key:0,class:"whitespace-pre-line select-text text-base dark:text-gray-300 w-full mb-1"},Lt={key:3,class:"mt-4 flex justify-center"},ue=1e3,Rt=Q({__name:"Logs",props:{logs:{},sections:{},totalLogs:{}},setup(O){const n=O,v=C(""),f=C(!1),i=C(!1),d=C([]),u=C(null),t=C(1),m=C(!1),w=C(ue),_=R(()=>m.value?d.value:d.value.slice(0,w.value));J(()=>n.logs,async h=>{h&&(f.value=!0,await Qe(),setTimeout(()=>{d.value=h.slice(0,ue),t.value=1,m.value=h.length<=ue,f.value=!1},0),setTimeout(()=>{v.value=n.logs.join(`
`)},0))},{immediate:!0}),J(t,()=>{w.value=t.value*ue});function g(h){const T=h.target;T.scrollHeight-T.scrollTop<=T.clientHeight+50&&b()}async function b(){i.value||m.value||(i.value=!0,setTimeout(()=>{const h=t.value*ue,T=(t.value+1)*ue;if(h<n.logs.length){const M=n.logs.slice(h,T);d.value=[...d.value,...M],t.value++,m.value=T>=n.logs.length}else m.value=!0;i.value=!1},0))}return(h,T)=>{const M=Ge("ULoading"),U=Je,H=be;return r(),c("div",Vt,[f.value?(r(),c("div",St,[a(M,{size:"lg"})])):d.value.length?(r(),c("div",{key:2,ref_key:"logContainer",ref:u,class:W([m.value?"h-[calc(100vh-120px)]":"h-[calc(100vh-180px)]","w-full overflow-y-scroll rounded border dark:border-gray-600 bg-gray-50 dark:bg-gray-700 px-4 sm:px-6 py-2"]),onScroll:g},[s("div",jt,[m.value?(r(),c("pre",Tt,"          "+x(v.value)+`
        `,1)):(r(!0),c(q,{key:1},me(_.value,(D,F)=>(r(),c("pre",{key:0+F,class:"whitespace-pre-line select-text text-base dark:text-gray-300 w-full mb-1"},x(D),1))),128))])],34)):(r(),z(U,{key:1})),d.value.length&&!m.value?(r(),c("div",Lt,[a(H,{loading:i.value,class:"w-full flex justify-center",label:`(loaded ${d.value.length} / ${n.logs.length}) Load All Logs`,onClick:T[0]||(T[0]=D=>m.value=!0)},null,8,["loading","label"])])):y("",!0)])}}}),Et={class:"mt-2"},zt={class:"ml-2"},Ut=Q({__name:"EquityCurve",props:{data:{}},setup(O){const n=Oe(),v=R(()=>n.value),f=C();let i=null,d=[];const u=O;J(u.data,_=>{}),J(v,_=>{w(_)}),_e(async()=>{await t()});async function t(){Ee.width=f.value.clientWidth,i=xe(f.value,Ee);for(const _ of u.data){const g=i.addLineSeries({lineWidth:2});g.setData(_.data),d.push(g)}i.timeScale().fitContent(),w(v.value)}Me(()=>{m()});function m(){i!==null&&(i.remove(),i=null),d&&(d=[])}function w(_){i===null||d===null||i.applyOptions(_==="light"?kt.chart:xt.chart)}return(_,g)=>(r(),c(q,null,[s("div",{ref_key:"chartContainer",ref:f,class:"rounded overflow-hidden border-2 border-gray-100 dark:border-gray-600"},null,512),s("div",Et,[(r(!0),c(q,null,me(_.data,b=>(r(),c("span",{key:b.name,class:"text-xs mr-2 rounded bg-white dark:bg-gray-700 p-1"},[s("span",{class:"inline-block",style:Ze({backgroundColor:b.color,width:"25px",height:"10px"})},null,4),s("span",zt,x(b.name),1)]))),128))])],64))}}),Ot={class:"flex items-center justify-between"},Mt=Q({__name:"FullscreenModal",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(O){const n=$e(O,"modelValue");return(v,f)=>{const i=be,d=Xe,u=Pe;return r(),z(u,{modelValue:n.value,"onUpdate:modelValue":f[1]||(f[1]=t=>n.value=t),fullscreen:""},{default:L(()=>[a(d,{ui:{base:"h-full flex flex-col",rounded:"",divide:"divide-y divide-gray-100 dark:divide-gray-800",body:{base:"grow"}}},{header:L(()=>[s("div",Ot,[s("div",null,[Te(v.$slots,"title")]),a(i,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:f[0]||(f[0]=t=>n.value=!1)})])]),default:L(()=>[Te(v.$slots,"default")]),_:3})]),_:3},8,["modelValue"])}}}),Pt={class:"w-16 overflow-hidden"},Bt={class:"w-8 overflow-hidden"},Nt={key:0,class:"w-full transition-all overflow-hidden duration-300 bg-gray-50 dark:bg-gray-800"},It=["onClick"],Dt={class:"w-16 overflow-hidden text-center"},At={class:"w-12 overflow-hidden text-center"},Ft={class:"w-8 overflow-hidden text-center"},Wt={class:"p-4"},qt={class:"mt-4"},Ht={class:"w-full text-sm"},Yt={class:"w-full"},Jt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Qt={class:"w-full flex justify-between py-2 px-4"},Gt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Zt={class:"w-full flex justify-between py-2 px-4"},Xt={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},Kt={class:"w-full flex justify-between py-2 px-4"},es={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},ts={class:"w-full flex justify-between py-2 px-4"},ss={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},os={class:"w-full"},ls={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},rs={class:"w-full flex justify-between py-2 px-4"},as={class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},ns={key:0,class:"w-full flex justify-between py-2 px-4"},is={key:1,class:"w-full flex justify-between bg-gray-50 dark:bg-gray-800 py-2 px-4"},ds={key:2,class:"w-full flex justify-between py-2 px-4"},us={class:"flex justify-end mt-4"},cs=Q({__name:"ChartOrders",props:{trade:{}},emits:["zoom"],setup(O,{emit:n}){const v=n,f=C(null),i=C(!1),d=C(!1);return(u,t)=>{const m=Ke,w=be,_=Pe;return r(),c(q,null,[a(w,{variant:"ghost",color:"gray",class:"w-full flex justify-between hover:bg-gray-100 dark:hover:bg-gray-800 text-xs border-b border-gray-100 dark:border-gray-800 rounded-none p-2",onClick:t[1]||(t[1]=g=>d.value=!l(d))},{default:L(()=>[s("div",{class:W(["w-2 transition-all duration-300",[l(d)?"rotate-90":"rotate-0"]])},t[4]||(t[4]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-4"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m8.25 4.5 7.5 7.5-7.5 7.5"})],-1)]),2),s("div",Pt,x(l(Y).roundPrice(u.trade.entry_price)),1),t[5]||(t[5]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:W(["w-16 overflow-hidden",u.trade.type.toLowerCase()==="long"?"text-green-500":"text-red-500"])},x(l(ie).round(u.trade.qty,2)),3),t[6]||(t[6]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:W([[u.trade.PNL_percentage>0?"text-green-500":"text-red-500"],"w-16 overflow-hidden text-xs"])},x(l(ie).round(u.trade.PNL_percentage,2))+"% ",3),t[7]||(t[7]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Bt,[a(w,{color:"gray",size:"xs",onClick:t[0]||(t[0]=Le(g=>v("zoom",u.trade.orders[0].id),["stop"]))},{default:L(()=>[a(m,{name:"i-heroicons-arrow-right"})]),_:1})])]),_:1}),l(d)?(r(),c("div",Nt,[t[12]||(t[12]=Be('<div class="flex justify-between items-center border-b-2 border-gray-200 dark:border-gray-700 px-1 py-2 text-xs"><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PRICE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-12 overflow-hidden italic font-bold uppercase text-center">TYPE</div><div class="w-1 opacity-20">|</div><div class="w-10 overflow-hidden italic font-bold uppercase text-center">SIDE</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(r(!0),c(q,null,me(u.trade.orders,(g,b)=>(r(),c("div",{key:b,class:"w-full flex justify-between items-center hover:bg-gray-200 dark:hover:bg-gray-900 text-xs py-2 border-b border-gray-200 cursor-pointer dark:border-gray-700 px-1",onClick:h=>{f.value=g,i.value=!0}},[s("div",Dt,x(l(Y).roundPrice(g.price)),1),t[8]||(t[8]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:W(["w-10 overflow-hidden text-center",g.side==="buy"?"text-green-500":"text-red-500"])},x(l(ie).round(g.qty,2)),3),t[9]||(t[9]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",At,x(g.type),1),t[10]||(t[10]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",{class:W([[g.side==="buy"?"text-green-500":"text-red-500"],"w-10 overflow-hidden text-center"])},x(g.side.toUpperCase()),3),t[11]||(t[11]=s("div",{class:"w-1 opacity-20"},"|",-1)),s("div",Ft,[a(w,{color:"gray",size:"xs",onClick:Le(h=>v("zoom",g.id),["stop"])},{default:L(()=>[a(m,{name:"i-heroicons-arrow-right"})]),_:2},1032,["onClick"])])],8,It))),128))])):y("",!0),a(_,{modelValue:l(i),"onUpdate:modelValue":t[3]||(t[3]=g=>fe(i)?i.value=g:null)},{default:L(()=>{var g,b,h,T,M,U,H,D,F,G,le;return[s("div",Wt,[s("div",qt,[s("div",Ht,[t[28]||(t[28]=s("h2",{class:"text-lg mb-2 font-bold italic dark:text-white text-center"}," Trade ",-1)),s("div",Yt,[s("div",Jt,[t[13]||(t[13]=s("div",{class:"font-bold"},"Entry Price",-1)),s("div",null,x(l(Y).roundPrice(u.trade.entry_price)),1)]),s("div",Qt,[t[14]||(t[14]=s("div",{class:"font-bold"},"Exit Price",-1)),s("div",null,x(l(Y).roundPrice(u.trade.exit_price)),1)]),s("div",Gt,[t[15]||(t[15]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,x(u.trade.qty),1)]),s("div",Zt,[t[16]||(t[16]=s("div",{class:"font-bold"},"Size",-1)),s("div",null,x(l(Y).roundPrice(u.trade.size)),1)]),s("div",Xt,[t[17]||(t[17]=s("div",{class:"font-bold"},"PNL",-1)),s("div",{class:W([u.trade.PNL>0?"text-green-500":"text-red-500"])},x(l(ie).round(u.trade.PNL,2))+" ("+x(l(ie).round(u.trade.PNL_percentage,2))+"%) ",3)]),s("div",Kt,[t[18]||(t[18]=s("div",{class:"font-bold"},"Fee",-1)),s("div",null,x(l(ie).round(u.trade.fee,2)),1)]),s("div",es,[t[19]||(t[19]=s("div",{class:"font-bold"},"Holding Period",-1)),s("div",null,x(l(Y).secondsToHumanReadable(u.trade.holding_period)),1)]),s("div",ts,[t[20]||(t[20]=s("div",{class:"font-bold"},"Opened At",-1)),s("div",null,x(new Date(u.trade.opened_at).toLocaleString()),1)]),s("div",ss,[t[21]||(t[21]=s("div",{class:"font-bold"},"Closed At",-1)),s("div",null,x(new Date(u.trade.closed_at).toLocaleString()),1)])]),t[29]||(t[29]=s("h2",{class:"text-lg font-bold italic dark:text-white mt-6 mb-2 text-center"}," Order ",-1)),s("div",os,[s("div",ls,[t[22]||(t[22]=s("div",{class:"font-bold"},"Side",-1)),s("div",{class:W([((g=l(f))==null?void 0:g.side)==="buy"?"text-green-500":"text-red-500"])},x((h=(b=l(f))==null?void 0:b.side)==null?void 0:h.toUpperCase()),3)]),s("div",rs,[t[23]||(t[23]=s("div",{class:"font-bold"},"Type",-1)),s("div",null,x((T=l(f))==null?void 0:T.type),1)]),s("div",as,[t[24]||(t[24]=s("div",{class:"font-bold"},"Qty",-1)),s("div",null,x((M=l(f))==null?void 0:M.qty),1)]),(U=l(f))!=null&&U.created_at?(r(),c("div",ns,[t[25]||(t[25]=s("div",{class:"font-bold"},"Created At",-1)),s("div",null,x(new Date((H=l(f))==null?void 0:H.created_at).toLocaleString()),1)])):y("",!0),(D=l(f))!=null&&D.executed_at?(r(),c("div",is,[t[26]||(t[26]=s("div",{class:"font-bold"},"Executed At",-1)),s("div",null,x(new Date((F=l(f))==null?void 0:F.executed_at).toLocaleString()),1)])):y("",!0),(G=l(f))!=null&&G.canceled_at?(r(),c("div",ds,[t[27]||(t[27]=s("div",{class:"font-bold"},"Canceled At",-1)),s("div",null,x(new Date((le=l(f))==null?void 0:le.canceled_at).toLocaleString()),1)])):y("",!0)])]),s("div",us,[a(w,{color:"gray",block:"",onClick:t[2]||(t[2]=pe=>i.value=!1)},{default:L(()=>t[30]||(t[30]=[we(" Close ")])),_:1})])])])]}),_:1},8,["modelValue"])],64)}}}),fs={class:"w-0 sidebar whitespace-nowrap relative transition-all duration-300"},ms={key:1,class:"h-full flex justify-center items-center text-xs text-gray-500"},ps=Q({__name:"ChartSidebar",props:ke({items:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:ke(["zoom"],["update:modelValue"]),setup(O,{emit:n}){const v=$e(O,"modelValue"),f=n;return(i,d)=>{const u=cs;return r(),c("div",fs,[s("div",{class:W([v.value?"w-96 p-2":"w-0 p-0","absolute h-full overflow-y-auto border-r-2 dark:border-gray-800 transition-all duration-300 z-0"])},[i.items.length>0?(r(),c(q,{key:0},[d[1]||(d[1]=Be('<div class="flex justify-between items-center border-b-2 p-2 text-xs dark:border-gray-800"><div class="w-2"></div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">ENTRY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">QTY</div><div class="w-1 opacity-20">|</div><div class="w-16 overflow-hidden italic font-bold uppercase text-center">PNL</div><div class="w-1 opacity-20">|</div><div class="w-8 overflow-hidden italic font-bold uppercase text-center"></div></div>',1)),(r(!0),c(q,null,me(i.items,(t,m)=>(r(),c("div",{key:m,class:"w-full"},[a(u,{trade:t,onZoom:d[0]||(d[0]=w=>f("zoom",w))},null,8,["trade"])]))),128))],64)):(r(),c("div",ms," No trades were executed "))],2)])}}}),vs={class:"w-full h-full flex justify-between border-2 border-gray-200 dark:border-gray-800 rounded-lg"},gs={class:"w-full flex flex-col h-full border dark:border-gray-800"},ys={key:0},bs=Q({__name:"BacktestCandlesChart",props:ke({form:{},results:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(O){const n=Oe(),v=C(2),f=$e(O,"modelValue"),i=O,d=C(),u=C([]);let t=null,m=null;const w=[],_=[],g=R(()=>Ne().params.id),b=R(()=>se.extraChartLines[g.value].find(k=>k.symbol===i.results.selectedRoute.symbol)),h=R(()=>n.value),T=R(()=>pe());J(h,k=>{G(k)}),J(()=>i.results.selectedRoute.symbol,()=>{F(),setTimeout(async()=>{await M()},100)}),_e(async()=>{setTimeout(async()=>{await M()},200)}),J(f,()=>{setTimeout(()=>{U()},300)});async function M(){var P,re,ae,N;ye.width=d.value.clientWidth,ye.height=d.value.clientHeight-Object.keys(b.value.charts).length*150,t=xe(d.value,ye),t.applyOptions({rightPriceScale:{borderColor:h.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:`${i.results.selectedRoute.symbol} • ${i.results.selectedRoute.timeframe}`}}),m=t.addCandlestickSeries();const k=se.candles[g.value].find($=>$.symbol===i.results.selectedRoute.symbol).candles;m.setData(k),m.setMarkers(se.orders[g.value].find($=>$.symbol===i.results.selectedRoute.symbol).orders);const V=String(k[0].open).indexOf("."),S=V===-1?0:String(k[k.length-1].open).length-V-1;v.value!==S&&(v.value=S,(v.value<0||v.value>100)&&(v.value=0),m.applyOptions({priceFormat:{type:"price",precision:v.value,minMove:Math.pow(10,-v.value).toFixed(v.value)}}));const B=(re=(P=se.lines[g.value])==null?void 0:P.find($=>$.symbol===i.results.selectedRoute.symbol))==null?void 0:re.lines;if(B)for(const $ of Object.keys(B)){const E=B[$];t.addLineSeries({lineWidth:1,title:$}).setData(E.data)}const Z=(N=(ae=se.horizontalLines[g.value])==null?void 0:ae.find($=>$.symbol===i.results.selectedRoute.symbol))==null?void 0:N.lines;if(Z)for(const $ of Object.keys(Z)){const A=Z[$];m.createPriceLine(A)}t.timeScale().fitContent();const X=new Set;Object.keys(b.value.charts).forEach(($,E)=>{const A={...ye};A.width=u.value[E].clientWidth,A.height=150;const e=xe(u.value[E],A);w.push(e),Object.keys(b.value.charts[$]).forEach(o=>{var ne,ee;const I=e.addLineSeries({lineWidth:1,title:o}),K=(ee=(ne=se.horizontalExtraLines[g.value])==null?void 0:ne.find(j=>j.symbol===i.results.selectedRoute.symbol))==null?void 0:ee.lines[$];if(K&&!X.has($)){for(const j of Object.keys(K)){const ve=K[j];I.createPriceLine(ve)}X.add($)}I.setData(b.value.charts[$][o].data),_.push(I)}),e.applyOptions({rightPriceScale:{borderColor:h.value==="light"?"#d1d4dc":"#4b5563",minimumWidth:80},watermark:{visible:!0,fontSize:16,horzAlign:"left",vertAlign:"bottom",color:"#888",text:$}}),e.timeScale().subscribeVisibleLogicalRangeChange(o=>{t.timeScale().setVisibleLogicalRange(o)}),E!==Object.keys(b.value.charts).length-1&&e.timeScale().applyOptions({visible:!1})}),t.subscribeCrosshairMove($=>{const E=H(m,$);Object.keys(b.value.charts).forEach((A,e)=>{D(w[e],_[e],E)})}),Object.keys(b.value.charts).forEach(($,E)=>{w[E].subscribeCrosshairMove(A=>{const e=H(_[E],A);D(t,m,e),w.forEach((o,I)=>{I!==E&&D(o,_[I],e)})})}),t.timeScale().subscribeVisibleLogicalRangeChange($=>{w.forEach(E=>{E.timeScale().setVisibleLogicalRange($)})}),G(h.value),w.length>0&&t.timeScale().applyOptions({visible:!1})}function U(){var k;t!==null&&(t.applyOptions({width:(k=d.value)==null?void 0:k.clientWidth}),w.forEach(V=>{var S;V.applyOptions({width:(S=d.value)==null?void 0:S.clientWidth})}))}Me(()=>{F()});function H(k,V){return V.time&&V.seriesData.get(k)||null}function D(k,V,S){if(S){k.setCrosshairPosition(S.value,S.time,V);return}k.clearCrosshairPosition()}function F(){t!==null&&(t.remove(),t=null),m!==null&&(m=null),w.length>0&&(w.forEach(k=>{k.remove()}),w.length=0),_.length>0&&(_.length=0)}function G(k){t!==null&&(t.applyOptions(k==="light"?ze.chart:Ue.chart),w.forEach(V=>{V.applyOptions(k==="light"?ze.chart:Ue.chart)}))}function le(k){const V=se.orders[g.value].find(B=>B.symbol===i.results.selectedRoute.symbol).orders,S=V.find(B=>B.order_id===k);if(S&&t){const B=(typeof S.time=="number",S.time),Z=t.timeScale(),X=V[1].time-V[0].time,P=B-X*5,re=B+X*5,ae=S.color;m==null||m.setMarkers(V.map(N=>N.order_id===k?{...N,color:"#FFA500"}:N)),Z.setVisibleRange({from:P,to:re}),setTimeout(()=>{m==null||m.setMarkers(V.map(N=>N.order_id===k?{...N,color:ae}:N))},2e3)}}function pe(){return i.results.trades.filter(k=>k.symbol===i.results.selectedRoute.symbol)}return(k,V)=>(r(),c("div",vs,[a(ps,{modelValue:f.value,"onUpdate:modelValue":V[0]||(V[0]=S=>f.value=S),items:l(T),onZoom:V[1]||(V[1]=S=>le(S))},null,8,["modelValue","items"]),s("div",{class:W([[f.value?"w-[calc(100%-384px)]":"w-full"],"h-full transition-all duration-300"])},[s("div",gs,[s("div",{ref_key:"chartContainer",ref:d,class:"rounded overflow-hidden flex-grow"},null,512),l(b)&&Object.keys(l(b).charts).length?(r(),c("div",ys,[(r(!0),c(q,null,me(Object.keys(l(b).charts),S=>(r(),c("div",{key:S,ref_for:!0,ref_key:"extraChartsRef",ref:u,class:"relative border-t-[1.5px] dark:border-gray-800"}))),128))])):y("",!0)])],2)]))}}),hs={key:0,class:"flex flex-col items-center justify-center select-none mt-[10%]"},ws=["textContent"],ks={class:"mt-8"},xs={class:"mt-8 flex flex-col gap-4"},_s={key:0,class:"mt-4"},$s={key:1,class:"mx-auto container mt-8"},Cs={key:0},Vs={class:"mb-4 mt-4"},Ss={class:"flex items-center select-none flex-1 my-4"},js={class:"grid grid-cols-1 gap-6 mt-8"},Ts={key:1,class:"w-full mx-auto"},Ls={key:4,class:"text-yellow-500 border-yellow-400 bg-yellow-50 dark:bg-gray-700 dark:text-yellow-400 mt-16 text-center text-2xl rounded border-2 border-dashed dark:border-gray-800 py-16 select-none"},Rs={class:"flex justify-start"},Es={key:0},zs={key:0},Us=["href"],Os=["href"],Ms=["href"],Ps={key:5,class:"my-4"},Bs={key:1},Ns=Q({__name:"BacktestTab",props:{form:{},results:{}},setup(O){const n=O,v=C(!1),f=C(!0),i=C(!1),d=C([]),u=C([]),t=C(!1),m=C(!1),w=ge().authToken,_=C(Re().public.apiBaseUrl),g=C(!1),b=R(()=>Ne().params.id),h=Ie(),T=ge(),M=et(),U=C([]),H=R(()=>T.jesseSupportedTimeframes.map(e=>({label:e,value:e}))),D=R(()=>n.form.routes.map(e=>({label:`${e.strategy} • ${e.symbol}`,value:e})));n.results.selectedRoute=n.form.routes[0],_e(async()=>{await T.initiate(),!n.form.exchange&&T.backtestingExchangeNames.length&&(n.form.exchange=T.backtestingExchangeNames[0]),(!n.results.showResults&&n.form.exchange||!U.value.length)&&await F()});async function F(){if(n.form.exchange)try{U.value=await T.getExchangeSupportedSymbols(n.form.exchange);for(let e=0;e<n.form.routes.length;e++)U.value.includes(n.form.routes[e].symbol)||(n.form.routes[e].symbol=U.value[0]);if(n.form.data_routes.length>0)for(let e=0;e<n.form.data_routes.length;e++)U.value.includes(n.form.data_routes[e].symbol)||(n.form.data_routes[e].symbol=U.value[0])}catch(e){console.error("Error updating supported symbols:",e)}}J(()=>n.form.exchange,async(e,o)=>{e!==o&&(U.value=[],await F())});const{cancel:G,newBacktest:le,retry:pe}=h;function k(e){if(u.value.length){for(let o=0;o<u.value.length;o++)oe("error",u.value[o]);return}d.value=[],h.start(e)}function V(e){d.value=[],h.rerun(e)}const S=e=>{if(u.value.length){for(let o=0;o<u.value.length;o++)oe("error",u.value[o]);return}d.value=[],h.startInNewTab(e)},B=R(()=>{let e=`/download/backtest/tradingview/${n.results.generalInfo.session_id}?token=${w}`;return _.value!=="/"&&(e=_.value+e),e});R(()=>{let e=`/download/backtest/full-reports/${n.results.generalInfo.session_id}?token=${w}`;return _.value!=="/"&&(e=_.value+e),e});const Z=R(()=>{let e=`/download/backtest/csv/${n.results.generalInfo.session_id}?token=${w}`;return _.value!=="/"&&(e=_.value+e),e}),X=R(()=>{let e=`/download/backtest/json/${n.results.generalInfo.session_id}?token=${w}`;return _.value!=="/"&&(e=_.value+e),e}),P=R(()=>h.formattedMetrics(b.value).length>0),re=R(()=>Y.remainingTimeText(n.results.progressbar.estimated_remaining_seconds));function ae(){try{d.value.length>1e6&&oe("success","Copying large log file, please wait..."),setTimeout(()=>{navigator.clipboard.writeText(d.value.join(`
`)),oe("success","Logs copied successfully"),m.value=!0,setTimeout(()=>{m.value=!1},3e3)},0)}catch{oe("error","Failed to copy logs")}}J(()=>n.form.start_date,e=>{n.form.finish_date<e&&(n.form.finish_date=e)});async function N(){const e=h.missingCandlesErrors[b.value];e&&(M.forms.push({id:Y.uuid(),exchange:e.exchange,symbol:e.symbol,start_date:e.start_date,executing:!1,waiting:!1,progressbar:{current:0,estimated_remaining_seconds:0},exception:{error:"",traceback:""},alert:{message:"",type:""}}),await dt("/candles/"),await M.start(M.forms[M.forms.length-1].id))}async function $(){d.value.length===0?await E():i.value=!0}async function E(){v.value=!0;try{const{data:e,error:o}=await ut(`/logs/backtest/${b.value}?token=${w}`,!1);if(o.value){oe("error",o.value.message),v.value=!1;return}const I=e.value;setTimeout(()=>{const ne=Y.decompressData(I.content).split(`
`).map(ee=>{const j=ee.match(/\[INFO \| (.*?)\] (.*)/);return j?`[${j[1]}] ${j[2]}`:ee});d.value=ne,v.value=!1,i.value=!0},0)}catch{oe("error","Failed to fetch logs"),v.value=!1}}async function A(){const e=Re().public.apiBaseUrl,o=ge().authToken,I=`${e}/backtest/download-log/${b.value}?token=${o}`;window.open(I,"_blank")}return(e,o)=>{const I=Rt,K=tt,ne=lt,ee=pt,j=be,Ce=vt,ve=ht,ce=at,Ve=wt,De=yt,Se=nt,te=it,Ae=Ut,je=rt,Fe=Mt,he=_t,We=$t,qe=gt,He=bt;return r(),c(q,null,[a(ne,{modelValue:l(i),"onUpdate:modelValue":o[0]||(o[0]=p=>fe(i)?i.value=p:null),title:"Logs"},{default:L(()=>[a(I,{logs:l(d)},null,8,["logs"])]),buttons:L(()=>[a(K,{text:"Copy",class:"inline-block",popper:{arrow:!0}},{default:L(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:ae},[l(m)?(r(),z(l(st),{key:0,class:"h-6 w-6","aria-hidden":"true"})):y("",!0),!l(m)&&l(d).length!=0?(r(),z(l(mt),{key:1,class:"h-6 w-6","aria-hidden":"true"})):y("",!0)])]),_:1}),a(K,{text:"Download",class:"inline-block ml-2",popper:{arrow:!0}},{default:L(()=>[s("button",{class:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full text-gray-400 hover:text-gray-500 dark:hover:text-gray-300 focus:outline-none",onClick:A},[l(d).length!=0?(r(),z(l(ot),{key:0,class:"h-6 w-6","aria-hidden":"true"})):y("",!0)])]),_:1})]),_:1},8,["modelValue"]),e.results.executing&&!e.results.showResults?(r(),c("div",hs,[s("div",null,[a(ee,{progress:e.results.progressbar.current},null,8,["progress"])]),e.results.exception.error?y("",!0):(r(),c("h3",{key:0,class:"mt-8 animate-pulse",textContent:x(l(re))},null,8,ws)),s("div",ks,[s("div",xs,[e.results.exception.error?(r(),z(j,{key:0,color:"primary",class:"w-64 flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Retry",trailing:!1,onClick:o[1]||(o[1]=p=>l(pe)((e._.provides[de]||e.$route).params.id))})):y("",!0),a(j,{color:"gray",ui:{color:{gray:{solid:"text-rose-500 dark:text-rose-400"}}},class:"w-64 flex justify-center",icon:"i-heroicons-no-symbol",size:"xl",variant:"solid",label:"Cancel",trailing:!1,onClick:o[2]||(o[2]=p=>l(G)((e._.provides[de]||e.$route).params.id))})]),e.form.debug_mode&&e.results.exception.error?(r(),c("div",_s,[a(j,{icon:"i-heroicons-clipboard-document-list",label:"Debugging Logs",color:"gray",size:"xl",variant:"solid",trailing:!1,class:"w-64 flex justify-center",onClick:$})])):y("",!0)]),e.results.exception.error&&e.results.executing?(r(),c("div",$s,[a(Ce,{modelValue:l(t),"onUpdate:modelValue":o[3]||(o[3]=p=>fe(t)?t.value=p:null),title:e.results.exception.error,content:e.results.exception.traceback,mode:"backtest","debug-mode":e.form.debug_mode},null,8,["modelValue","title","content","debug-mode"])])):y("",!0)])):y("",!0),a(He,null,{left:L(()=>[!e.results.executing&&!e.results.showResults?(r(),c("div",Cs,[l(h).missingCandlesErrors[l(b)]?(r(),z(ve,{key:0,icon:"i-heroicons-exclamation-triangle",color:"rose",variant:"soft",class:"mb-4"},{title:L(()=>o[25]||(o[25]=[s("h3",{class:"text-lg font-semibold"},"Missing Required Warmup Candles",-1)])),description:L(()=>[s("p",Vs,[o[26]||(o[26]=we(" Your strategy requires ")),o[27]||(o[27]=s("strong",{class:"font-bold"},"warmup candles",-1)),we(' for "'+x(l(h).missingCandlesErrors[l(b)].symbol)+'" on "'+x(l(h).missingCandlesErrors[l(b)].exchange)+'" starting from "'+x(l(h).missingCandlesErrors[l(b)].start_date)+'". These candles are needed for proper strategy initialization. ',1)]),a(j,{label:"Import Required Candles",icon:"i-heroicons-arrow-down-tray",onClick:N})]),_:1})):y("",!0),a(ce,{class:"mb-4",title:"Exchange"}),a(Ve,{modelValue:e.form.exchange,"onUpdate:modelValue":o[4]||(o[4]=p=>e.form.exchange=p),placeholder:"Select an exchange...",searchable:"",options:l(ge)().backtestingExchangeNames,size:"lg",class:"mt-2 mb-16"},null,8,["modelValue","options"]),a(De,{"total-routes-error":l(u),timeframes:l(H),form:e.form,results:e.results,symbols:l(U),mode:"backtest"},null,8,["total-routes-error","timeframes","form","results","symbols"]),a(ce,{class:"mt-16",title:"Duration"}),s("div",Ss,[a(Se,{modelValue:e.form.start_date,"onUpdate:modelValue":o[5]||(o[5]=p=>e.form.start_date=p),type:"date",variant:"outline",size:"lg",class:"w-full mr-2"},null,8,["modelValue"]),a(Se,{modelValue:e.form.finish_date,"onUpdate:modelValue":o[6]||(o[6]=p=>e.form.finish_date=p),type:"date",variant:"outline",size:"lg",class:"w-full ml-2"},null,8,["modelValue"])]),a(ce,{class:"mt-16",title:"Options"}),s("div",js,[a(te,{modelValue:e.form.debug_mode,"onUpdate:modelValue":o[7]||(o[7]=p=>e.form.debug_mode=p),title:"Debug Mode",description:"Logs every step of the execution. Very helpful for debugging your strategy but takes a lot longer to execute"},null,8,["modelValue"]),a(te,{modelValue:e.form.export_chart,"onUpdate:modelValue":o[8]||(o[8]=p=>e.form.export_chart=p),title:"Generate Interactive Charts",description:"Generate interactive charts for backtest results with details."},null,8,["modelValue"]),a(te,{modelValue:e.form.export_tradingview,"onUpdate:modelValue":o[9]||(o[9]=p=>e.form.export_tradingview=p),title:"Export Tradingview",description:"Exports the executed trades in a format accepted by TradingView's Pine Editor. Useful to look at the executed orders on their chart."},null,8,["modelValue"]),a(te,{modelValue:e.form.export_csv,"onUpdate:modelValue":o[10]||(o[10]=p=>e.form.export_csv=p),title:"Export CSV",description:"Exports executed trades in a CSV format"},null,8,["modelValue"]),a(te,{modelValue:e.form.export_json,"onUpdate:modelValue":o[11]||(o[11]=p=>e.form.export_json=p),title:"Export JSON",description:"Exports executed trades in a JSON format"},null,8,["modelValue"]),a(te,{modelValue:e.form.fast_mode,"onUpdate:modelValue":o[12]||(o[12]=p=>e.form.fast_mode=p),title:"Fast Mode",description:"Runs the backtest faster by using an improved algorithm. This is supposed to yield the same results; however, it's currently experimental, which is why it's an option."},null,8,["modelValue"]),a(te,{modelValue:e.form.benchmark,"onUpdate:modelValue":o[13]||(o[13]=p=>e.form.benchmark=p),title:"Benchmark",description:"If enabled, the backtest will compare the performance of the strategy against the buy and hold strategy of the market."},null,8,["modelValue"])])])):y("",!0),e.results.showResults?(r(),c("div",Ts,[s("div",null,[l(P)?(r(),z(ce,{key:0,class:"mb-4",title:"Equity Curve"})):y("",!0),l(P)?(r(),z(Ae,{key:1,data:e.results.charts.equity_curve},null,8,["data"])):y("",!0),l(P)?(r(),z(ce,{key:2,class:"mt-16 mb-4",title:"Performance"})):y("",!0),l(P)?(r(),z(je,{key:3,data:l(h).formattedMetrics(l(b))},null,8,["data"])):y("",!0),l(P)?y("",!0):(r(),c("div",Ls," No trades were executed via this strategy! "))]),a(Fe,{modelValue:l(g),"onUpdate:modelValue":o[17]||(o[17]=p=>fe(g)?g.value=p:null)},{title:L(()=>[s("div",Rs,[a(Ve,{modelValue:e.results.selectedRoute,"onUpdate:modelValue":o[14]||(o[14]=p=>e.results.selectedRoute=p),"value-attribute":"value",options:l(D)},null,8,["modelValue","options"]),a(j,{class:"ml-2",color:"gray",label:l(f)?"Hide Trades":"Show Trades",onClick:o[15]||(o[15]=p=>f.value=!l(f))},null,8,["label"])])]),default:L(()=>[a(bs,{modelValue:l(f),"onUpdate:modelValue":o[16]||(o[16]=p=>fe(f)?f.value=p:null),results:e.results,form:e.form},null,8,["modelValue","results","form"])]),_:1},8,["modelValue"])])):y("",!0)]),right:L(()=>[e.results.executing?y("",!0):(r(),c("div",Es,[e.results.showResults?(r(),c("div",zs,[a(j,{class:"w-full flex justify-center",icon:"i-heroicons-arrow-path",size:"xl",variant:"solid",label:"Rerun",trailing:!1,onClick:o[18]||(o[18]=p=>V((e._.provides[de]||e.$route).params.id))}),a(j,{class:"w-full flex justify-center mt-4",color:"green",icon:"i-heroicons-arrow-uturn-left",size:"xl",variant:"solid",label:"New session",trailing:!1,onClick:o[19]||(o[19]=p=>l(le)((e._.provides[de]||e.$route).params.id))}),e.form.debug_mode?(r(),z(j,{key:0,class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-clipboard-document-list",size:"xl",variant:"solid",label:"Debugging Logs",loading:l(v),trailing:!1,onClick:o[20]||(o[20]=p=>$())},null,8,["loading"])):y("",!0),e.form.export_chart?(r(),z(j,{key:1,class:"mt-4 flex justify-center items-center btn-secondary text-center",color:"gray",icon:"i-heroicons-chart-bar",size:"xl",block:"",variant:"solid",label:"View charts",trailing:!1,onClick:o[21]||(o[21]=p=>g.value=!0)})):y("",!0),e.form.export_csv&&l(P)?(r(),c("a",{key:2,href:l(Z),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[a(j,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"CSV",trailing:!1})],8,Us)):y("",!0),e.form.export_json&&l(P)?(r(),c("a",{key:3,href:l(X),target:"_blank",class:"flex justify-center items-center btn-secondary text-center w-full"},[a(j,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"JSON",trailing:!1})],8,Os)):y("",!0),e.form.export_tradingview&&l(P)?(r(),c("a",{key:4,href:l(B),target:"_blank",class:"flex justify-center items-center btn-secondary text-center mb-4 w-full"},[a(j,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-document-arrow-down",size:"xl",variant:"solid",label:"TradingView Pine Editor",trailing:!1})],8,Ms)):y("",!0),e.results.showResults&&e.results.alert&&e.results.alert.message?(r(),c("div",Ps,[a(ve,{color:"teal",icon:"i-heroicons-check-circle",variant:"soft",title:e.results.alert.message,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"white",variant:"link"},onClose:o[22]||(o[22]=p=>e.results.alert.message="")},null,8,["title"])])):y("",!0),a(he,{class:"mt-8 mb-4",size:"lg",label:"General Info"}),a(We,{data:e.results.info},null,8,["data"]),a(he,{class:"mt-8 mb-4",size:"lg",label:"Routes"}),a(qe,{data:e.results.routes_info,"header-items":["Symbol","Timeframe","Strategy"],header:""},null,8,["data"]),e.results.hyperparameters.length?(r(),z(he,{key:6,class:"mt-8 mb-4",size:"lg",label:"Hyperparameters"})):y("",!0),e.results.hyperparameters.length?(r(),z(je,{key:7,data:e.results.hyperparameters},null,8,["data"])):y("",!0)])):(r(),c("div",Bs,[a(j,{class:"w-full flex justify-center",icon:"i-heroicons-bolt",size:"xl",variant:"solid",label:"Start",trailing:!1,onClick:o[23]||(o[23]=p=>k((e._.provides[de]||e.$route).params.id))}),a(j,{class:"w-full flex justify-center mt-4",color:"gray",icon:"i-heroicons-plus",size:"xl",variant:"solid",label:"Start in a new tab",trailing:!1,onClick:o[24]||(o[24]=p=>S((e._.provides[de]||e.$route).params.id))})]))]))]),_:1})],64)}}}),Is={class:"w-full"},Xs=Q({__name:"[id]",setup(O){Ct({title:"Backtest - Jesse"});const n=Ie(),v=R(()=>n.tabs),f=R(()=>ct().params.id),i=R(()=>{if(!v.value[f.value]){const d=Object.keys(v.value);if(d.length>0){const u=v.value[d[0]];return ft().push(`/backtest/${u.id}`),u}}return v.value[f.value]});return Object.keys(v.value).length===0&&n.addTab(),(d,u)=>{const t=Ye,m=Ns;return r(),c(q,null,[s("div",Is,[a(t,{"current-tab":i.value?i.value.id:null,tabs:v.value,mode:"backtest",onClose:l(n).closeTab,onCancel:l(n).cancel},null,8,["current-tab","tabs","onClose","onCancel"])]),i.value?(r(),z(m,{key:0,form:i.value.form,results:i.value.results},null,8,["form","results"])):y("",!0)],64)}}});export{Xs as default};
